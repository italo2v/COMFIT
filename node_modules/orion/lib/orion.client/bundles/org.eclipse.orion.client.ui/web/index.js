!function(){function e(){for(var e=navigator.userAgent,t={browser:!1,version:!1},n=1,r=[{name:"Chrome/Chromium",regExp:/(?:chrome|crios|chromium)\/(\d+)/i,minVersion:24},{name:"Firefox",regExp:/firefox\/(\d+)/i,minVersion:17},{name:"Microsoft Internet Explorer",regExp:/msie\s(\d+)/i,minVersion:10},{name:"Microsoft Internet Explorer",regExp:/Trident\/(\d+)/i,minVersion:6},{name:"Safari",regExp:/version\/(\d+).*?safari/i,minVersion:6}],i=0;i<r.length;i++){var o=r[i],s=e.match(o.regExp);if(s){t.browser=!0,t.version=s[n]>=o.minVersion,t.name=o.name;break}}return t}function t(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}function n(e){throw alert(e),new Error("unsupported browser")}var r=e();if(r.browser)r.version||n("Sorry, your browser version is not supported.\n\nTo use Orion, please upgrade to the latest version of "+r.name+".\n");else if(t()&&!localStorage.skipBrowserCheck){if(!confirm("Sorry, your browser is not supported. The latest version of Chrome, Firefox or Safari web browser is recommended.\nContinue anyway?"))throw"unsupported browser";localStorage.skipBrowserCheck=1}else t()||n("Sorry, your browser is not supported.\n\nTo use Orion, the latest version of the Chrome, Firefox, or Safari web browser is recommended.\n");return{isSupportedBrowser:e,supportsLocalStorage:t,throwBrowserAlert:n}}(),define("orion/browserCompatibility",function(){}),function(e,t){"function"==typeof define&&define.amd?define("orion/Deferred",t):"object"==typeof exports?module.exports=t():(e.orion=e.orion||{},e.orion.Deferred=t())}(this,function(){function e(){for(var e;e=o.shift();)e();s=!1}function t(e){o.push(e),s||(s=!0,u())}function n(e){return function(t){e(t)}}function r(e,t,r){try{var i=e(t),o=i&&("object"==typeof i||"function"==typeof i)&&i.then;if("function"==typeof o)if(i===r.promise)r.reject(new TypeError);else{var s=i.cancel;"function"==typeof s?r._parentCancel=s.bind(i):delete r._parentCancel,o.call(i,n(r.resolve),n(r.reject),n(r.progress))}else r.resolve(i)}catch(u){r.reject(u)}}function i(){function e(){for(var e;e=a.shift();){var t=e.deferred,n="fulfilled"===c?"resolve":"reject",i=e[n];"function"==typeof i?r(i,u,t):t[n](u)}}function n(n){delete f._parentCancel,c="rejected",u=n,a.length&&t(e)}function o(r){function s(e){return function(t){c&&"assumed"!==c||e(t)}}delete f._parentCancel;try{var l=r&&("object"==typeof r||"function"==typeof r)&&r.then;if("function"==typeof l)if(r===f)n(new TypeError);else{c="assumed";var h=r&&r.cancel;if("function"!=typeof h){var d=new i;r=d.promise;try{l(d.resolve,d.reject,d.progress)}catch(p){d.reject(p)}h=r.cancel,l=r.then}u=r,l.call(r,s(o),s(n)),f._parentCancel=h.bind(r)}else c="fulfilled",u=r,a.length&&t(e)}catch(v){s(n)(v)}}function s(){var e=f._parentCancel;if(e)delete f._parentCancel,e();else if(!c){var t=new Error("Cancel");t.name="Cancel",n(t)}}var u,c,a=[],f=this;this.resolve=function(e){return c||o(e),f},this.reject=function(e){return c||n(e),f},this.progress=function(e){return c||a.forEach(function(t){if(t.progress)try{t.progress(e)}catch(n){}}),f.promise},this.cancel=function(){return f._parentCancel?setTimeout(s,0):s(),f},this.then=function(n,r,o){var s=new i;return s._parentCancel=f.promise.cancel,a.push({resolve:n,reject:r,progress:o,deferred:s}),("fulfilled"===c||"rejected"===c)&&t(e),s.promise},this.promise={then:f.then,cancel:f.cancel}}var o=[],s=!1,u=function(){if("undefined"!=typeof process&&"function"==typeof process.nextTick){var t=process.nextTick;return function(){t(e)}}if("function"==typeof MutationObserver){var n=document.createElement("div"),r=new MutationObserver(e);return r.observe(n,{attributes:!0}),function(){n.setAttribute("class","_tick")}}return function(){setTimeout(e,0)}}();return i.all=function(e,t){function n(e,t){u||(s[e]=t,0===--o&&c.resolve(s))}function r(e,r){if(!u){if(t)try{return void n(e,t(r))}catch(i){r=i}c.reject(r)}}var o=e.length,s=[],u=!1,c=new i;return c.then(void 0,function(){u=!0,e.forEach(function(e){e.cancel&&e.cancel()})}),0===o?c.resolve(s):e.forEach(function(e,t){e.then(n.bind(void 0,t),r.bind(void 0,t))}),c.promise},i.when=function(e,t,n,r){var o,s;return e&&"function"==typeof e.then?o=e:(s=new i,s.resolve(e),o=s.promise),o.then(t,n,r)},i}),define("orion/EventTarget",[],function(){function e(){this._namedListeners={}}return e.prototype={dispatchEvent:function(e){if(!e.type)throw new Error("unspecified type");var t=this._namedListeners[e.type];return t&&t.forEach(function(t){try{"function"==typeof t?t(e):t.handleEvent(e)}catch(n){"undefined"!=typeof console&&console.log(n)}}),!e.defaultPrevented},addEventListener:function(e,t){("function"==typeof t||t.handleEvent)&&(this._namedListeners[e]=this._namedListeners[e]||[],this._namedListeners[e].push(t))},removeEventListener:function(e,t){var n=this._namedListeners[e];if(n)for(var r=0;r<n.length;r++)if(n[r]===t){1===n.length?delete this._namedListeners[e]:n.splice(r,1);break}}},e.prototype.constructor=e,e.attach=function(t){var n=new e;t.dispatchEvent=n.dispatchEvent.bind(n),t.addEventListener=n.addEventListener.bind(n),t.removeEventListener=n.removeEventListener.bind(n)},e}),define("orion/serviceregistry",["orion/Deferred","orion/EventTarget"],function(e,t){function n(e,t,n){this._properties=n||{},this._properties["service.id"]=e,this._properties.objectClass=t,this._properties["service.names"]=t}function r(e,t,n){this._serviceId=e,this._serviceReference=t,this._internalRegistry=n}function i(t,n){function r(r){return function(){var i;try{if(!n())throw new Error("Service was unregistered");var o=t[r].apply(t,Array.prototype.slice.call(arguments));if(o&&"function"==typeof o.then)return o;i=new e,i.resolve(o)}catch(s){i=new e,i.reject(s)}return i.promise}}var i;for(i in t)"function"==typeof t[i]&&(this[i]=r(i))}function o(e,t){this.type=e,this.serviceReference=t}function s(){this._entries=[],this._namedReferences={},this._serviceEventTarget=new t;var e=this;this._internalRegistry={isRegistered:function(t){return e._entries[t]?!0:!1},unregisterService:function(t){var n=e._entries[t];if(!n)throw new Error("Service has already been unregistered: "+t);var r=n.reference;e._serviceEventTarget.dispatchEvent(new o("unregistering",r)),e._entries[t]=null;var i=r.getProperty("objectClass");i.forEach(function(t){for(var n=e._namedReferences[t],i=0;i<n.length;i++)if(n[i]===r){1===n.length?delete e._namedReferences[t]:n.splice(i,1);break}})},modifyService:function(t){var n=e._entries[t];if(!n)throw new Error("Service not found while trying to send modified event: "+t);var r=n.reference;e._serviceEventTarget.dispatchEvent(new o("modified",r))}}}return n.prototype={getPropertyKeys:function(){var e,t=[];for(e in this._properties)this._properties.hasOwnProperty(e)&&t.push(e);return t},getProperty:function(e){return this._properties[e]}},n.prototype.constructor=n,r.prototype={unregister:function(){this._internalRegistry.unregisterService(this._serviceId)},getReference:function(){if(!this._internalRegistry.isRegistered(this._serviceId))throw new Error("Service has already been unregistered: "+this._serviceId);return this._serviceReference},setProperties:function(e){var t=this._serviceReference._properties;this._serviceReference._properties=e||{},e["service.id"]=this._serviceId,e.objectClass=t.objectClass,e["service.names"]=t["service.names"],this._internalRegistry.modifyService(this._serviceId)}},r.prototype.constructor=r,s.prototype={getService:function(e){var t;if("string"==typeof e){var n=this._namedReferences[e];n&&n.some(function(e){return t=this._entries[e.getProperty("service.id")].service,!!t},this)}else{var r=this._entries[e.getProperty("service.id")];r&&(t=r.service)}return t||null},getServiceReferences:function(e){if(e)return this._namedReferences[e]?this._namedReferences[e]:[];var t=[];return this._entries.forEach(function(e){e&&t.push(e.reference)}),t},registerService:function(e,t,s){if("undefined"==typeof t||null===t)throw new Error("invalid service");"string"==typeof e?e=[e]:Array.isArray(e)||(e=[]);var u=this._entries.length,c=new n(u,e,s),a=this._namedReferences;e.forEach(function(e){a[e]=a[e]||[],a[e].push(c)});var f=new i(t,this._internalRegistry.isRegistered.bind(null,u));this._entries.push({reference:c,service:f});var l=this._internalRegistry;return this._serviceEventTarget.dispatchEvent(new o("registered",c)),new r(u,c,l)},addEventListener:function(e,t){this._serviceEventTarget.addEventListener(e,t)},removeEventListener:function(e,t){this._serviceEventTarget.removeEventListener(e,t)}},s.prototype.constructor=s,{ServiceRegistry:s}}),define("orion/xsrfUtils",[],function(){function e(){var e,t,n,i=document.cookie.split(";");for(e=0;e<i.length;e++)if(t=i[e].substr(0,i[e].indexOf("=")).trim(),n=i[e].substr(i[e].indexOf("=")+1).trim(),t==r)return n}function t(t){var n=e();n&&(t[r]=n)}function n(t){var n=e();n&&t.setRequestHeader(r,n)}var r="x-csrf-token";return{XSRF_TOKEN:r,getCSRFToken:e,setNonceHeader:t,addCSRFNonce:n}}),function(){function e(e){if("string"!=typeof e)throw new TypeError}function t(e){return e?e.split("&"):[]}function n(e){return 0===e.length?"":e.join("&")}function r(e){var t=/([^=]*)(?:=?)(.*)/.exec(e),n=t[1]?decodeURIComponent(t[1]):"",r=t[2]?decodeURIComponent(t[2]):"";return[n,r]}function i(e){var t=encodeURIComponent(e[0]);return e[1]&&(t+="="+encodeURIComponent(e[1])),t}function o(e,n){var i="",o=[],s=0;return{next:function(){if(i!==e.query&&(i=e.query,o=t(i)),s<o.length){var u=r(o[s++]);switch(n){case"keys":return u[0];case"values":return u[1];case"keys+values":return[u[0],u[1]];default:throw new TypeError}}throw j}}}function s(e){Object.defineProperty(this,"_url",{get:function(){return e._url}})}function u(e,t){if(!e.scheme&&t&&(e.scheme=t.scheme,!e.host&&t.host&&(e.userinfo=t.userinfo,e.host=t.host,e.port=t.port,e.pathRelative=!0)),e.pathRelative)if(e.path){if("/"!==e.path[0]){var n=/^(.*\/)[^\/]*$/.exec(t.path)[1]||"/";e.path=n+e.path}}else e.path=t.path}function c(e){return e.toLowerCase()}function a(e){return e?/[1-9]\d*$/.exec(e)[0]:""}function f(e){var t=[];return e.split("/").forEach(function(e){".."===e?t.pop():"."!==e&&t.push(e)}),t.join("/")}function l(e){e.scheme&&(e.scheme=c(e.scheme)),e.port&&(e.port=a(e.port)),e.host&&e.path&&(e.path=f(e.path))}function h(e){return e.replace(/\s/g,function(e){return"%"+e.charCodeAt(0).toString(16)})}function d(e,t){if("string"!=typeof e)throw new TypeError;e=h(e);var n=_.exec(e);if(!n)return null;var r={};if(r.scheme=n[1]||"",r.scheme&&!E.test(r.scheme))return null;var i=n[2];if(i){var o=y.exec(i);if(r.userinfo=o[1],r.host=o[2],r.port=o[3],r.port&&!b.test(r.port))return null}return r.path=n[3],r.query=n[4],r.fragment=n[5],u(r,t),l(r),r}function p(e){var t=e.scheme?e.scheme+":":"";return e.host&&(t+="//",e.userinfo&&(t+=e.userinfo+"@"),t+=e.host,e.port&&(t+=":"+e.port)),t+=e.path,e.query&&(t+="?"+e.query),e.fragment&&(t+="#"+e.fragment),t}function v(e,t){var n;if(t){if(t=t.href||t,n=d(t),!n||!n.scheme)throw new SyntaxError;Object.defineProperty(this,"_baseURL",{value:n})}var r=d(e,n);if(!r)throw new SyntaxError;Object.defineProperty(this,"_input",{value:e,writable:!0}),Object.defineProperty(this,"_url",{value:r,writable:!0});var i=new s(this);Object.defineProperty(this,"query",{get:function(){return this._url?i:null},enumerable:!0})}try{var g;if("function"==typeof window.URL&&0!==window.URL.length&&"http:"===(g=new window.URL("http://www.w3.org?q")).protocol&&g.query)return}catch(m){}var _=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/,y=/^(?:(.*)@)?(\[[^\]]*\]|[^:]*)(?::(.*))?$/,w=/^\S*$/,E=/^([a-zA-Z](?:[a-zA-Z0-9+-.])*)$/,b=/^\d*$/,S=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)$/,P=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)(?::(\d*))?$/,C=/^([^?#\s]*)$/,L=/^([^\s]*)$/,O=w,R=/([^:]*):?(.*)/,j="undefined"!=typeof StopIteration?StopIteration:new Error("Stop Iteration"),x={"ftp:":"21","gopher:":"70","http:":"80","https:":"443","ws:":"80","wss:":"443"};Object.defineProperties(s.prototype,{get:{value:function(n){e(n);var i,o=t(this._url.query);return o.some(function(e){var t=r(e);return t[0]===n?(i=t[1],!0):void 0}),i},enumerable:!0},set:{value:function(o,s){e(o),e(s);var u=t(this._url.query),c=u.some(function(e,t){var n=r(e);return n[0]===o?(n[1]=s,u[t]=i(n),!0):void 0});c||u.push(i([o,s])),this._url.query=n(u)},enumerable:!0},has:{value:function(n){e(n);var i=t(this._url.query);return i.some(function(e){var t=r(e);return t[0]===n?!0:void 0})},enumerable:!0},"delete":{value:function(i){e(i);var o=t(this._url.query),s=o.filter(function(e){var t=r(e);return t[0]!==i});return s.length!==o.length?(this._url.query=n(s),!0):!1},enumerable:!0},clear:{value:function(){this._url.query=""},enumerable:!0},forEach:{value:function(e,t){if("function"!=typeof e)throw new TypeError;var n=o(this._url,"keys+values");try{for(;;){var r=n.next();e.call(t,r[1],r[0],this)}}catch(i){if(i!==j)throw i}},enumerable:!0},keys:{value:function(){return o(this._url,"keys")},enumerable:!0},values:{value:function(){return o(this._url,"values")},enumerable:!0},items:{value:function(){return o(this._url,"keys+values")}},size:{get:function(){return t(this._url.query).length},enumerable:!0},getAll:{value:function(n){e(n);var i=[],o=t(this._url.query);return o.forEach(function(e){var t=r(e);t[0]===n&&i.push(t[1])}),i},enumerable:!0},append:{value:function(r,o){e(r),e(o);var s=t(this._url.query);s.push(i([r,o])),this._url.query=n(s)},enumerable:!0}}),Object.defineProperties(v.prototype,{href:{get:function(){return this._url?p(this._url):this._input},set:function(t){e(t),this._input=t,this._url=d(this._input,this._baseURL)},enumerable:!0},origin:{get:function(){return this._url&&this._url.host?this.protocol+"//"+this.host:""},enumerable:!0},protocol:{get:function(){return this._url?this._url.scheme+":":":"},set:function(t){if(e(t),this._url){var n=":"===t.slice(-1)?t.substring(0,t.length-1):t;(""===n||E.test(n))&&(this._url.scheme=c(n))}},enumerable:!0},_userinfo:{get:function(){return this._url?this._url.userinfo:""},set:function(t){e(t),this._url&&(this._url.userinfo=t)}},username:{get:function(){if(!this._url)return"";var e=R.exec(this._userinfo),t=decodeURIComponent(e[1]||"");return t},set:function(t){if(e(t),this._url){var n=R.exec(this._userinfo),r=[encodeURIComponent(t||"")];n[2]&&r.push(n[2]),this._userinfo=r.join(":")}},enumerable:!0},password:{get:function(){if(!this._url)return"";var e=R.exec(this._userinfo),t=decodeURIComponent(e[2]||"");return t},set:function(t){if(e(t),this._url){var n=R.exec(this._userinfo),r=[n[1]||""];t&&r.push(encodeURIComponent(t)),this._userinfo=r.join(":")}},enumerable:!0},host:{get:function(){var e="";return this._url&&this._url.host&&(e+=this._url.host,this._url.port&&(e+=":"+this._url.port)),e},set:function(t){if(e(t),this._url){var n=P.exec(t);n&&(this._url.host=n[1],this._url.port=a(n[2]))}},enumerable:!0},hostname:{get:function(){return this._url?this._url.host:""},set:function(t){if(e(t),this._url){var n=S.exec(t);n&&(this._url.host=t)}},enumerable:!0},port:{get:function(){var e=this._url?this._url.port||"":"";return e&&e===x[this.protocol]&&(e=""),e},set:function(t){if(e(t),this._url){var n=b.exec(t);n&&(this._url.port=a(t))}},enumerable:!0},pathname:{get:function(){return this._url?this._url.path:""},set:function(t){if(e(t),this._url){var n=C.exec(t);n&&(this._url.host&&t&&"/"!==t[0]&&(t="/"+t),this._url.path=t?f(t):"")}},enumerable:!0},search:{get:function(){return this._url&&this._url.query?"?"+this._url.query:""},set:function(t){if(e(t),this._url){t&&"?"===t[0]&&(t=t.substring(1));var n=L.exec(t);n&&(this._url.query=t)}},enumerable:!0},hash:{get:function(){return this._url&&this._url.fragment?"#"+this._url.fragment:""},set:function(t){if(e(t),this._url){t&&"#"===t[0]&&(t=t.substring(1));var n=O.exec(t);n&&(this._url.fragment=t)}},enumerable:!0}});var T=window.URL||window.webkitURL;T&&T.createObjectURL&&(Object.defineProperty(v,"createObjectURL",{value:T.createObjectURL.bind(T),enumerable:!1}),Object.defineProperty(v,"revokeObjectURL",{value:T.revokeObjectURL.bind(T),enumerable:!1})),window.URL=v}(),define("orion/URL-shim",function(){}),define("orion/xhr",["orion/Deferred","orion/xsrfUtils","orion/URL-shim"],function(e,t){function n(e,t,n,r){var i,o="undefined"!=typeof n.response?n.response:n.responseText,s="string"==typeof o?o:null;try{i=n.status}catch(u){i=0}var c={args:t,response:o,responseText:s,status:i,url:e,xhr:n};return"undefined"!=typeof r&&(c.error=r),c}function r(e){return new URL(location.href).origin===new URL(e,location.href).origin}function i(i,o,s){s=s||{};var u=arguments.length>3&&arguments[3]?arguments[3]:new XMLHttpRequest,c=new e,a=s.headers||{};r(o)&&t.setNonceHeader(a);var f,l=s.log||!1;"undefined"==typeof a["X-Requested-With"]&&(a["X-Requested-With"]="XMLHttpRequest"),"undefined"==typeof s.data||"POST"!==i&&"PUT"!==i||(f=s.data);var h=!1,d=!1;c.promise.then(void 0,function(e){h=!0,!d&&e instanceof Error&&"Cancel"===e.name&&u.abort()}),u.onabort=function(){if(d=!0,!h){var e=new Error("Cancel");e.name="Cancel",c.reject(e)}},u.onload=function(){var e=n(o,s,u);200<=u.status&&u.status<400?c.resolve(e):(c.reject(e),l&&"undefined"!=typeof console&&console.log(new Error(u.statusText)))},u.onerror=function(){var e=n(o,s,u);c.reject(e),l&&"undefined"!=typeof console&&console.log(new Error(u.statusText))},u.onprogress=function(e){e.xhr=u,c.progress(e)};try{if(u.open(i,o,!0),"string"==typeof s.responseType&&(u.responseType=s.responseType),"number"==typeof s.timeout)if("number"==typeof u.timeout)u.timeout=s.timeout,u.addEventListener("timeout",function(){c.reject(n(o,s,u,"Timeout exceeded"))});else{var p=setTimeout(function(){c.reject(n(o,s,u,"Timeout exceeded"))},s.timeout);c.promise.then(clearTimeout.bind(null,p),clearTimeout.bind(null,p))}Object.keys(a).forEach(function(e){u.setRequestHeader(e,a[e])}),u.send(f||null)}catch(v){c.reject(n(o,s,u,v))}return c.promise}return i}),define("orion/metrics",["orion/Deferred"],function(){function e(e,t,n,r){window[i]?window[i]("send","event",e,t,n,r):o&&o.push({command:"send",arg0:"event",arg1:e,arg2:t,arg3:n,arg4:r})}function t(e,t){window.performance&&window.performance.getEntriesByName&&window.performance.mark&&!window.performance.getEntriesByName(e).length&&(window.performance.mark(e),n("page",e,window.performance.now(),t))}function n(e,t,n,r){window[i]?window[i]("send","timing",e,t,Math.round(n),r):o&&o.push({command:"send",arg0:"timing",arg1:e,arg2:t,arg3:Math.round(n),arg4:r})}function r(e,t){window[i]?window[i]("set",e,t):o&&o.push({command:"set",arg0:e,arg1:t})}var i="OrionGA",o=[],s=function(e,t){var n=e.shift();return n?void(n.init?n.init().then(function(e){return e.tid?(function(e,t,n,r,i,o,s){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,o=t.createElement(n),s=t.getElementsByTagName(n)[0],o.async=1,o.src=r,s.parentNode.insertBefore(o,s)}(window,document,"script","//www.google-analytics.com/analytics.js",i),t=t||{},e.siteSpeedSampleRate&&(t.siteSpeedSampleRate=e.siteSpeedSampleRate),window[i]("create",e.tid,t),window[i]("send","pageview"),o.forEach(function(e){window[i](e.command,e.arg0,e.arg1,e.arg2,e.arg3,e.arg4)}),void(o=null)):void(o=null)},function(){s(e,t)}):s(e,t)):void(o=null)},u=function(e,t){var n=e.getServiceReferences("orion.analytics.google"),r=[];n.forEach(function(t){r.push(e.getService(t))}),s(r,t)};return{init:s,initFromRegistry:u,logEvent:e,logPageLoadTiming:t,logTiming:n,setDimension:r}}),define("orion/preferences",["require","orion/Deferred","orion/xhr","orion/metrics"],function(e,t,n){function r(e,t,n){this._name=e,this._providers=t,this._changeCallback=n,this._flushPending=!1,this._cached=null,this._stores=[],this._pendingDeletes=[],this._dirty=[]}function i(e,t){return{get:function(n,r){if(0===t)return null;var i=localStorage.getItem(e+n);if(null===i)return null;var o=JSON.parse(i);return r||-1===t||o._expires&&o._expires>(new Date).getTime()?(delete o._expires,o):null},set:function(n,r){if(0!==t)if(-1!==t&&(r._expires=(new Date).getTime()+1e3*t),0===Object.keys(r).length)localStorage.removeItem(e+n);else{var i=JSON.stringify(r);localStorage.setItem(e+n,i),delete r._expires}},remove:function(t){localStorage.removeItem(e+t)}}}function o(e){this._currentPromises={},this._cache=new i("/orion/preferences/user",3600),this._service=null,this.available=function(){if(!this._service){var t=e.getServiceReferences("orion.core.preference.provider");t.length>0&&(this._service=e.getService(t[0]))}return!!this._service}}function s(e){this._location=e,this._currentPromise=null,this._cache=new i("/orion/preferences/default",3600)}function u(){this._cache=new i("/orion/preferences/local",-1)}function c(t,n){this._userProvider=new o(t),this._localProvider=new u,this._changeListeners=[],n=n||"defaults.pref",-1===n.indexOf("://")&&(n=e.toUrl(n)),this._defaultsProvider=new s(n),this._serviceRegistration=t.registerService("orion.core.preference",this)}return r.prototype={_flush:function(){for(var e=[],n=0;n<this._stores.length;++n){var r=this._stores[n];if(-1!==this._dirty.indexOf(r)&&e.push(this._providers[n].put(this._name,r)),this._pendingDeletes[n]&&this._pendingDeletes[n].length>0){for(var i=0;i<this._pendingDeletes[n].length;i++)e.push(this._providers[n].remove(this._name,this._pendingDeletes[n][i]));delete this._pendingDeletes[n]}}return this._dirty=[],t.all(e)},_scheduleFlush:function(e){e&&-1===this._dirty.indexOf(e)&&this._dirty.push(e),this._flushPending||(this._flushPending=!0,window.setTimeout(function(){this._flushPending&&(this._flushPending=!1,this._flush())}.bind(this),0))},_getCached:function(){if(!this._cached){this._cached={};for(var e=0;e<this._stores.length;++e){var t=this._stores[e];for(var n in t)t.hasOwnProperty(n)&&"undefined"==typeof this._cached[n]&&(this._cached[n]=t[n])}}return this._cached},keys:function(){return Object.keys(this._getCached())},get:function(e){var t=this._getCached();return t[e]},put:function(e,t){if(0!==this._stores.length){var n=this._stores[0];n[e]!==t&&(this.valueChanged(e,t),n[e]=t,this._cached=null,this._scheduleFlush(n))}},remove:function(e){for(var t=0;t<this._stores.length;++t){var n=this._stores[t];if(n.hasOwnProperty(e))return delete n[e],this._pendingDeletes[t]||(this._pendingDeletes[t]=[]),this._pendingDeletes[t].push(e),this._cached=null,this._scheduleFlush(),!0}return!1},clear:function(){for(var e=0;e<this._stores.length;++e)this._stores[e]={},this._scheduleFlush(this._stores[e]);this._cached=null},sync:function(e){if(this._flushPending)return this._flushPending=!1,this._flush();for(var n=this,r=[],i=0;i<this._providers.length;++i)r.push(this._providers[i].get(this._name,e).then(function(e){return function(t){n._stores[e]=t}}(i)));return t.all(r).then(function(){n._cached=null,n._getCached()})},flush:function(){this._flush()},valueChanged:function(e,t){var n=this._name+"/"+e;if("string"==typeof t)this._changeCallback(n,t);else{var r=this._stores[0];for(var i in t)if("pid"!==i&&(!r[e]||r[e][i]!==t[i])){var o=String(t[i]);this._changeCallback(n+"/"+i,o)}}}},o.prototype={get:function(e,n){if(this._currentPromises[e])return this._currentPromises[e];var r=new t,i=null;if(n?this._cache.remove(e):i=this._cache.get(e),null!==i)r.resolve(i);else{this._currentPromises[e]=r;var o=this;this._service.get(e).then(function(t){o._cache.set(e,t),delete o._currentPromises[e],r.resolve(t)},function(t){if(404===t.status){var n={};o._cache.set(e,n),delete o._currentPromises[e],r.resolve(n)}else delete o._currentPromises[e],r.resolve(o._cache.get(e,!0)||{})})}return r},put:function(e,t){return this._cache.set(e,t),this._service.put(e,t)},remove:function(e,t){var n=this._cache.get(e);return delete n[t],this._cache.set(e,n),this._service.remove(e,t)}},s.prototype={get:function(e,r){if(this._currentPromise)return this._currentPromise;var i=new t,o=null;if(r?this._cache.remove(e):o=this._cache.get(e),null!==o)i.resolve(o);else{this._currentPromise=i;var s=this;n("GET",this._location,{headers:{"Orion-Version":"1"},timeout:15e3}).then(function(t){var n=JSON.parse(t.response);s._cache.set(e,n[e]||{}),s._currentPromise=null,i.resolve(n[e]||{})},function(t){if(401===t.xhr.status||404===t.xhr.status)s._cache.set(e,{}),s._currentPromise=null,i.resolve({});else{s._currentPromise=null;var n=s._cache.get(e,!0);i.resolve(null!==n?n[e]||{}:{})}})}return i},put:function(){var e=new t;return e.resolve(),e},remove:function(e,t){var n=this._cache.get(e);delete n[t],this.put(e,n)}},u.prototype={get:function(e){var n=new t,r=this._cache.get(e);return n.resolve(null!==r?r:{}),n},put:function(e,n){var r=new t;return this._cache.set(e,n),r.resolve(),r},remove:function(e,t){var n=this._cache.get(e);delete n[t],this.put(e,n)}},c.DEFAULT_SCOPE=1,c.LOCAL_SCOPE=2,c.USER_SCOPE=4,c.prototype={listenForChangedSettings:function(e,t,n){return(!t||"number"!=typeof t||t>7||1>t)&&(n=t,t=c.DEFAULT_SCOPE|c.LOCAL_SCOPE|c.USER_SCOPE),window.addEventListener("storage",n,!1),0!==(c.USER_SCOPE&t)?"/orion/preferences/user"+e:0!==(c.LOCAL_SCOPE&t)?"/orion/preferences/local"+e:"/orion/preferences/default"+e},addChangeListener:function(e){"function"==typeof e&&this._changeListeners.push(e)},getPreferences:function(e,t){(!t||"number"!=typeof t||t>7||1>t)&&(t=c.DEFAULT_SCOPE|c.LOCAL_SCOPE|c.USER_SCOPE);var n=[];c.USER_SCOPE&t&&this._userProvider.available()&&n.push(this._userProvider),c.LOCAL_SCOPE&t&&n.push(this._localProvider),c.DEFAULT_SCOPE&t&&n.push(this._defaultsProvider);var i=new r(e,n,this._prefChangeListener.bind(this)),o=i.sync().then(function(){return i});return o},getSetting:function(e,t,n){for(var r,i=0;i<e.length;i++)if(e[i].label===t)for(var o=0;o<e[i].data.length;o++)if(e[i].data[o].label===n){r=e[i].data[o].value;break}return r},removeChangeListener:function(e){if("function"==typeof e)for(var t=0;t<this._changeListeners.length;t++)if(this._changeListeners[t]===e)return void this._changeListeners.splice(t,1)},_prefChangeListener:function(e,t){this._changeListeners.forEach(function(n){n(e,t)})}},{PreferencesService:c}}),define("orion/pluginregistry",["orion/Deferred","orion/EventTarget","orion/URL-shim"],function(e,t){function n(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;n.sort(),r.sort();for(var i=0,o=n.length;o>i;i++){var s=n[i];if(s!==r[i])return!1;var u=e[s],c=t[s];if(u!==c&&JSON.stringify(u)!==JSON.stringify(c))return!1}return!0}function r(e){if(-1===e.indexOf("://"))try{return new URL(e,location.href).href}catch(t){}return e}function i(e){function t(){return n=n||Object.keys(e)}var n=null,r={key:function(e){return t()[e]},getItem:function(t){return e[t]},setItem:function(t,r){e[t]=r,n=null},removeItem:function(t){delete e[t],n=null},clear:function(){t().forEach(function(t){delete e[t]}.bind(this)),n=null}};return Object.defineProperty(r,"length",{get:function(){return t().length}}),r}function o(e,t){if(t&&t instanceof XMLHttpRequest){var n,r;try{n=t.status,r=t.statusText}catch(i){n=0,r=""}return{status:n||0,statusText:r}}return t}function s(e){var t=e?JSON.parse(JSON.stringify(e,o)):e;return e instanceof Error&&(t.__isError=!0,t.message=t.message||e.message,t.name=t.name||e.name),t}function u(e,t){this.type=e,this.plugin=t}function c(e,t){this.__objectId=e,this.__methods=t}function a(r,i,o){function a(e){E&&o.postMessage(e,E)}function f(t){if(!E)return(new e).reject(new Error("plugin not connected"));t.id=String(T++);var n=new e;A[t.id]=n,n.then(null,function(e){"active"===j&&e instanceof Error&&"Cancel"===e.name&&a({requestId:t.id,method:"cancel",params:e.message?[e.message]:[]})});var r=Object.prototype.toString;return t.params.forEach(function(e,i){if("[object Object]"===r.call(e)&&!(e instanceof c)){var o,s;for(o in e)"[object Function]"===r.call(e[o])&&(s=s||[],s.push(o));if(s){var u=k++;U[u]=e;var a=function(){delete U[u]};n.then(a,a),t.params[i]=new c(u,s)}}}),o.postMessage(t,E),n.promise}function l(e,t){e||0===e?a({id:e,result:null,error:t}):console.log(t)}function h(e,t,n,r){r.forEach(function(e,t){if(e&&"undefined"!=typeof e.__objectId){var n={};e.__methods.forEach(function(t){n[t]=function(){return f({objectId:e.__objectId,method:t,params:Array.prototype.slice.call(arguments)})}}),r[t]=n}});var i="undefined"==typeof e?null:{id:e,result:null,error:null};try{var o=n.apply(t,r);if(!i)return;o&&"function"==typeof o.then?(I[e]=o,o.then(function(t){delete I[e],i.result=t,a(i)},function(t){I[e]&&(delete I[e],i.error=s(t),a(i))},function(){a({responseId:e,method:"progress",params:Array.prototype.slice.call(arguments)})})):(i.result=o,a(i))}catch(u){i&&(i.error=s(u),a(i))}}function d(e){try{if(e.method){var t=e.method,n=e.params||[];if("serviceId"in e){var r=D[e.serviceId];r||l(e.id,"service not found"),t in r?h(e.id,r,r[t],n):l(e.id,"method not found")}else if("objectId"in e){var i=U[e.objectId];i||l(e.id,"object not found"),t in i?h(e.id,i,i[t],n):l(e.id,"method not found")}else if("requestId"in e){var s=I[e.requestId];s&&"cancel"===t&&s.cancel&&s.cancel.apply(s,n)}else if("responseId"in e){var u=A[e.responseId];u&&"progress"===t&&u.progress&&u.progress.apply(u,n)}else if("loading"===e.method)E.loading();else if("plugin"===e.method){E.connected();var c=e.params[0];S({headers:c.headers,services:c.services}).then(function(){w&&w.resolve(_)})}else{if("timeout"!==e.method)throw new Error("Bad method: "+e.method);w&&w.reject(e.error)}}else{var a=A[String(e.id)];if(delete A[String(e.id)],e.error){var f=o.handleServiceError(_,e.error);a.reject(f)}else a.resolve(e.result)}}catch(d){console.log("Plugin._messageHandler "+d)}}function p(e){var n={};if(e.methods&&(e.methods.forEach(function(t){n[t]=function(){var n={serviceId:e.serviceId,method:t,params:Array.prototype.slice.call(arguments)};return"active"===j?f(n):_.start({"transient":!0}).then(function(){return f(n)})}}),n.addEventListener&&n.removeEventListener)){var r=new t,i=k++;U[i]={handleEvent:r.dispatchEvent.bind(r)};var o=new c(i,["handleEvent"]),s=n.addEventListener;n.addEventListener=function(e,t){r._namedListeners[e]||s(e,o),r.addEventListener(e,t)};var u=n.removeEventListener;n.removeEventListener=function(e,t){r.removeEventListener(e,t),r._namedListeners[e]||u(e,o)}}return n}function v(e){var t=JSON.parse(JSON.stringify(e.properties));t.__plugin__=r;var n=e.names||e.type||[];return Array.isArray(n)||(n=[n]),t.objectClass=n,t}function g(e){var t=p(e),n=v(e),r=o.registerService(e.names||e.type,t,n);x[e.serviceId]={registration:r,proxy:t}}function m(){o.persist(r,{created:P,headers:C,services:L,autostart:O,lastModified:R})}var _=this;i=i||{};var y,w,E,b,S,P=i.created||(new Date).getTime(),C=i.headers||{},L=i.services||[],O=i.autostart,R=i.lastModified||0,j="installed",x={},T=0,k=0,I={},A={},U={},D={};this._default=!1,this._persist=m,this._resolve=function(){j="resolved",o.dispatchEvent(new u("resolved",_))},this._getAutostart=function(){return O},this._getCreated=function(){return P},this.getLocation=function(){return r},this.getHeaders=function(){return JSON.parse(JSON.stringify(C))},this.getName=function(){var e=this.getHeaders();return e?e.name||"":null},this.getVersion=function(){var e=this.getHeaders();return e?e.version||"0.0.0":null},this.getLastModified=function(){return R},this.getServiceReferences=function(){var e=[];return Object.keys(x).forEach(function(t){e.push(x[t].registration.getReference())}),e},this.setParent=function(t){return b!==t?(b=t,_.stop({"transient":!0}).then(function(){return"started"===O?_.start({"transient":!0}):"lazy"===O?_.start({lazy:!0,"transient":!0}):void 0})):(new e).resolve()},this.getState=function(){return j},this.getProblemLoading=function(){return _._problemLoading?!0:!1},this.start=function(t){if("uninstalled"===j)return(new e).reject(new Error("Plugin is uninstalled"));if(y)return y.promise.then(this.start.bind(this,t));if("active"===j)return(new e).resolve();if(!t||!t.transient){var n=t&&t.lazy?"lazy":"started";n!==O&&(O=n,m())}var i=o.getState();if("starting"!==i&&"active"!==i)return t.transient?(new e).reject(new Error("start transient error")):(new e).resolve();if("installed"===j)try{this._resolve()
}catch(s){return(new e).reject(s)}if("resolved"===j&&L.forEach(function(e){g(e)}),t&&t.lazy)return"starting"!==j&&(j="starting",o.dispatchEvent(new u("lazy activation",_))),(new e).resolve();var c=new e;return y=c,j="starting",_._problemLoading=null,o.dispatchEvent(new u("starting",_)),w=new e,E=o.connect(r,d,b),w.then(function(){w=null,j="active",o.dispatchEvent(new u("started",_)),y=null,c.resolve()},function(){w=null,j="stopping",o.dispatchEvent(new u("stopping",_)),Object.keys(x).forEach(function(e){x[e].registration.unregister(),delete x[e]}),o.disconnect(E),E=null,j="resolved",y=null,o.dispatchEvent(new u("stopped",_)),_._problemLoading=!0,c.reject(new Error("Failed to load plugin: "+r)),_._default&&(R=0,m())}),c.promise},this.stop=function(t){if("uninstalled"===j)return(new e).reject(new Error("Plugin is uninstalled"));if(y)return y.promise.then(this.stop.bind(this,t));if(t&&t.transient||"stopped"!==O&&(O="stopped",m()),"active"!==j&&"starting"!==j)return(new e).resolve();var n=new e;return y=n,j="stopping",o.dispatchEvent(new u("stopping",_)),Object.keys(x).forEach(function(e){x[e].registration.unregister(),delete x[e]}),E&&(o.disconnect(E),E=null),j="resolved",y=null,o.dispatchEvent(new u("stopped",_)),n.resolve(),n.promise},S=function(t){if(_.problemLoading=null,"uninstalled"===j)return(new e).reject(new Error("Plugin is uninstalled"));if(!t)return 0===R&&(R=(new Date).getTime(),m()),o.loadManifest(r).then(S,function(){_._problemLoading=!0,_._default&&(R=0,m()),console.log("Failed to load plugin: "+r)});var i=C,s=L,c=O;if(C=t.headers||{},L=t.services||[],O=t.autostart||O,t.lastModified?R=t.lastModified:(R=(new Date).getTime(),m()),n(C,i)&&n(L,s)&&O===c)return(new e).resolve();if("active"===j||"starting"===j){var a=[];Object.keys(L).forEach(function(e){var t=L[e];a.push(e);var r=x[e];if(r){if(n(t.methods,Object.keys(r.proxy))){var i=v(t),o=r.registration.getReference(),s={};return o.getPropertyKeys().forEach(function(e){s[e]=o.getProperty(e)}),void(n(i,s)||r.registration.setProperties(i))}r.registration.unregister(),delete x[e]}g(t)}),Object.keys(x).forEach(function(e){-1===a.indexOf(e)&&(x[e].registration.unregister(),delete x[e])})}return"active"===j&&(o.disconnect(E),w=new e,E=o.connect(r,d,b),w.then(function(){w=null},function(){w=null,j="stopping",o.dispatchEvent(new u("stopping"),_),Object.keys(x).forEach(function(e){x[e].registration.unregister(),delete x[e]}),o.disconnect(E),E=null,j="resolved",o.dispatchEvent(new u("stopped",_))})),(new e).resolve()},this.update=function(e){return S(e).then(function(){o.dispatchEvent(new u("updated",_))})},this.uninstall=function(){return"uninstalled"===j?(new e).reject(new Error("Plugin is uninstalled")):"active"===j||"starting"===j||"stopping"===j?this.stop().then(this.uninstall.bind(this),this.uninstall.bind(this)):(o.removePlugin(this),j="uninstalled",o.dispatchEvent(new u("uninstalled",_)),(new e).resolve())}}function f(n,o){function s(e){var t=e.source;p.some(function(n){if(t===n.target){try{var r;if("undefined"==typeof n.useStructuredClone){var i="string"!=typeof e.data;r=i?e.data:JSON.parse(e.data),n.useStructuredClone=i}else r=n.useStructuredClone?e.data:JSON.parse(e.data);n.handler(r)}catch(o){}return!0}})}o=o||{};var c=o.storage||localStorage;c.getItem||(c=i(c));var f,h="installed",d=[],p=[],v=new t,g={},m={registerService:n.registerService.bind(n),connect:function(e,t,n,r){function i(e){var n=new Error(e);n.name="timeout",t({method:"timeout",error:n})}var o={handler:t,url:e},s=setTimeout(i.bind(null,"Load timeout for: "+e),r||15e3),u=document.createElement("iframe");return u.name=e+"_"+(new Date).getTime(),u.src=e,u.onload=function(){clearTimeout(s),s=setTimeout(i.bind(null,"Plugin handshake timeout for: "+e),5e3)},u.sandbox="allow-scripts allow-same-origin allow-forms",u.style.width=u.style.height="100%",u.frameBorder=0,(n||f).appendChild(u),o.target=u.contentWindow,o.connected=function(){clearTimeout(s)},o.loading=function(){clearTimeout(s),s=setTimeout(i.bind(null,"Plugin handshake timeout for: "+e),6e4)},o.close=function(){if(clearTimeout(s),u){var e=u.parentNode;e&&e.removeChild(u),u=null}},p.push(o),o},disconnect:function(e){for(var t=0;t<p.length;t++)if(e===p[t]){p.splice(t,1);try{e.close()}catch(n){}break}},removePlugin:function(e){for(var t=0;t<d.length;t++)if(e===d[t]){d.splice(t,1);break}c.removeItem("plugin."+e.getLocation())},persist:function(e,t){c.setItem("plugin."+e,JSON.stringify(t))},postMessage:function(e,t){t.target.postMessage(t.useStructuredClone?e:JSON.stringify(e),t.url)},dispatchEvent:function(e){try{v.dispatchEvent(e)}catch(t){console&&console.log("PluginRegistry.dispatchEvent "+t)}},loadManifest:function(t){var n=new e,r=m.connect(t,function(e){if(r&&e.method)if("manifest"===e.method||"plugin"===e.method){var t=e.params[0];m.disconnect(r),r=null,n.resolve(t)}else"timeout"===e.method&&(m.disconnect(r),r=null,n.reject(e.error))});return n.promise},getState:function(){return h},handleServiceError:function(e,t){if(t&&401===t.status){var n=e.getHeaders(),r=e.getName()||e.getLocation(),i=document.createElement("span");if(i.appendChild(document.createTextNode("Authentication required for: "+r+".")),n.login){i.appendChild(document.createTextNode(" "));var o=document.createElement("a");o.target="_blank",o.textContent="Login",o.href=n.login,l.test(o.href)?(i.appendChild(o),i.appendChild(document.createTextNode(" and re-try the request."))):console.log("Illegal Login URL: "+n.login)}var s=new XMLSerializer;return{Severity:"Error",HTML:!0,Message:s.serializeToString(i)}}if(t.__isError){var u=t;t=new Error(u.message),Object.keys(u).forEach(function(e){t[e]=u[e]}),delete t.__isError}return t}};this.getLocation=function(){return"System"},this.getHeaders=function(){return{}},this.getName=function(){return"System"},this.getVersion=function(){return"0.0.0"},this.getLastModified=function(){return 0},this.getState=m.getState,this.init=function(){if("starting"!==h&&"active"!==h&&"stopping"!==h){addEventListener("message",s,!1);for(var e=[],t=0,n=c.length;n>t;t++)e.push(c.key(t));e.forEach(function(e){if(0===e.indexOf("plugin.")){var t=e.substring("plugin.".length),n=JSON.parse(c.getItem(e));n.created&&d.push(new a(t,n,m))}}),d.sort(function(e,t){return e._getCreated()<t._getCreated()?-1:1}),o.parent?f=o.parent:(f=document.createElement("div"),o.visible||(f.style.display="none",f.style.visibility="hidden"),document.body.appendChild(f)),o.plugins&&Object.keys(o.plugins).forEach(function(e){e=r(e);var t=this.getPlugin(e);if(t)t._default=!0;else{var n=o.plugins[e];"object"!=typeof n&&(n={}),n.autostart=n.autostart||o.defaultAutostart||"lazy",t=new a(e,n,m),t._default=!0,d.push(t)}}.bind(this)),h="starting"}},this.start=function(){if("starting"!==h&&this.init(),"starting"!==h)return(new e).reject("Cannot start framework. Framework is already "+h+".");var t=[],n=(new Date).getTime();return d.forEach(function(e){var r=e._getAutostart();return 0===e.getLastModified()?void t.push(e.update().then(function(){return"started"===r?e.start({"transient":!0}):"lazy"===r?e.start({lazy:!0,"transient":!0}):void e._resolve()})):void("started"===r?t.push(e.start({"transient":!0})):"lazy"===r?(t.push(e.start({lazy:!0,"transient":!0})),n>e.getLastModified()+864e5&&e.update()):e._resolve())}),e.all(t,function(e){console.log("PluginRegistry.stop "+e)}).then(function(){h="active"})},this.stop=function(){if("starting"!==h&&"active"!==h)return(new e).reject("Cannot stop registry. Registry is already "+h+".");h="stopping";var t=[];return d.forEach(function(e){t.push(e.stop({"transient":!0}))}),e.all(t,function(e){console.log("PluginRegistry.stop "+e)}).then(function(){if(!o.parent){var e=f.parentNode;e&&e.removeChild(f)}f=null,removeEventListener("message",s),h="resolved"})},this.update=function(){this.stop().then(this.start.bind(this))},this.uninstall=function(){return(new e).reject("Cannot uninstall registry")},this.installPlugin=function(t,n){t=r(t);var i=this.getPlugin(t);if(i)return(new e).resolve(i);if(g[t])return g[t];if(n)return i=new a(t,n,m),d.push(i),i._persist(),m.dispatchEvent(new u("installed",i)),(new e).resolve(i);var o=m.loadManifest(t).then(function(e){return i=new a(t,e,m),d.push(i),i._persist(),delete g[t],m.dispatchEvent(new u("installed",i)),i},function(e){throw delete g[t],e});return g[t]=o,o},this.getPlugins=function(){return d.slice()},this.getPlugin=function(e){var t=null;return e=r(e),d.some(function(n){return e===n.getLocation()?(t=n,!0):void 0}),t},this.addEventListener=v.addEventListener.bind(v),this.removeEventListener=v.removeEventListener.bind(v),this.resolvePlugins=function(){var e=!0;return d.forEach(function(t){e=e&&t._resolve()}),e}}var l=new RegExp("^http[s]?","i");return{Plugin:a,PluginRegistry:f}}),define("orion/objects",[],function(){function e(e){for(var t=Object.prototype.hasOwnProperty,n=1,r=arguments.length;r>n;n++){var i=arguments[n];for(var o in i)t.call(i,o)&&(e[o]=i[o])}return e}return{clone:function(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var n=Object.create(Object.getPrototypeOf(t));return e(n,t),n},mixin:e,toArray:function(e){return Array.isArray(e)?e:[e]}}}),define("orion/serviceTracker",[],function(){function e(e,r){function i(e){var t=e.getProperty("service.id"),n=this.addingService(e);n&&(a[t]=e,f[t]=n)}function o(e){var t=e.getProperty("service.id"),n=f[t];delete a[t],delete f[t],this.removedService(e,n)}function s(e){return-1!==e.getProperty("objectClass").indexOf(r)}this.serviceRegistry=e;var u,c,a={},f={},l=t;this.close=function(){if(l!==n)throw"Already closed";l=t,e.removeEventListener("registered",u),e.removeEventListener("unregistering",c),u=null,c=null;var r=this;this.getServiceReferences().forEach(function(e){o.call(r,e)}),"function"==typeof this.onClose&&this.onClose()},this.getServiceReferences=function(){var e=Object.keys(a);return e.length?e.map(function(e){return a[e]}):null},this.open=function(){if(l!==t)throw"Already open";l=n;var a=this;u=function(e){return s(e.serviceReference)&&(i.call(a,e.serviceReference),"function"==typeof a.onServiceAdded)?a.onServiceAdded(e.serviceReference,a.serviceRegistry.getService(e.serviceReference)):void 0},c=function(e){s(e.serviceReference)&&o.call(a,e.serviceReference)},e.addEventListener("registered",u),e.addEventListener("unregistering",c),e.getServiceReferences(r).forEach(function(t){return i.call(a,t),"function"==typeof a.onServiceAdded?a.onServiceAdded(t,e.getService(t)):void 0}),"function"==typeof this.onOpen&&this.onOpen()}}var t=0,n=1;return e.prototype={addingService:function(e){return this.serviceRegistry.getService(e)},onOpen:null,onClose:null,onServiceAdded:null,removedService:function(){}},e}),define("orion/config",["orion/Deferred","orion/objects","orion/preferences","orion/serviceTracker"],function(e,t,n,r){var i,o,s,u,c,a=n.PreferencesService,f=a.DEFAULT_SCOPE,l="pid",h="orion.cm.managedservice",d="/cm/configurations";return i=function(t,n,i){function o(e,t,n){f[e]||(f[e]=[]),d[e]||(d[e]=[]),f[e].push(t),d[e].push(n)}function s(e,t,n){var r=f[e],i=d[e];r.length>1?r.splice(r.indexOf(t),1):delete f[e],i.length>1?i.splice(i.indexOf(n),1):delete d[e]}function u(e){return f[e]||[]}function c(e){return d[e]||[]}function a(e,t,r){t.forEach(function(i,o){try{var s=e[o].getProperty("__plugin__"),u=s&&n.getPlugin(s);(!s||u&&"active"===u.getState())&&t[o].updated(r)}catch(c){"undefined"!=typeof console&&console.log(c)}})}r.call(this,t,h);var f={},d={},p=function(n){var r=[];return n.plugin.getServiceReferences().forEach(function(e){if(-1!==e.getProperty("objectClass").indexOf(h)){var n=e.getProperty(l),o=t.getService(e);if(n&&o){var s=i._find(n),u=s&&s.getProperties();r.push(o.updated(u))}}}),e.all(r)};this.addingService=function(e){var n=e.getProperty(l),r=t.getService(e);return n&&r?(o(n,e,r),r):null},this.onServiceAdded=function(e,t){var n=e.getProperty(l),r=i._find(n);a([e],[t],r&&r.getProperties())},this.onOpen=function(){n.addEventListener("started",p)},this.onClose=function(){n.removeEventListener("started",p)},this.notifyUpdated=function(e){var t=e.getPid();a(u(t),c(t),e.getProperties())},this.notifyDeleted=function(e){var t=e.getPid();a(u(t),c(t),null)},this.removedService=function(e,t){var n=e.getProperty(l);s(n,e,t)}},o=function(){function e(e,t,n){this.store=new s(this,n),this.configAdmin=new u(this,this.store),this.tracker=new i(e,t,this.store)}return e.prototype={getConfigurationAdmin:function(){var e=this;return this.configAdmin._init().then(function(t){return e.tracker.open(),t})},notifyDeleted:function(e){this.tracker.notifyDeleted(e)},notifyUpdated:function(e){this.tracker.notifyUpdated(e)}},e}(),u=function(){function e(e,t){this.factory=e,this.store=t}return e.prototype={_prefName:d,_init:function(){var e=this;return this.store._init().then(function(){return e})},getConfiguration:function(e){return this.store.get(e)},getDefaultConfiguration:function(e){return this.store._find(e,f)},listConfigurations:function(){return this.store.list()}},e}(),s=function(){function t(t,n){this.factory=t,this.prefsService=n,this.configs=this.defaultConfigs=null,this.pref=null;var r=this;this.initPromise=e.all([this.prefsService.getPreferences(d,f),this.prefsService.getPreferences(d)]).then(function(e){var t=e[0];r.pref=e[1],r.defaultConfigs=r._toConfigs(t,!0),r.configs=r._toConfigs(r.pref,!1,t)})}return t.prototype={_toConfigs:function(e,t,n){var r=Object.create(null),i=this;return e.keys().forEach(function(o){if(!r[o]){var s=e.get(o),u=n&&n.get(o);"object"==typeof s&&null!==s&&Object.keys(s).length>0&&(s[l]=o,r[o]=new c(i.factory,i,s,t,u))}}),r},_init:function(){return this.initPromise},_find:function(e,t){return t===a.DEFAULT_SCOPE?this.defaultConfigs[e]||null:this.configs[e]||null},get:function(e){var t=this._find(e),n=this._find(e,f);if(!t){var r=n&&n.getProperties(!0);t=new c(this.factory,this,e,!1,r),this.configs[e]=t}return t},list:function(){var e=this,t=[];return this.pref.keys().forEach(function(n){var r=e._find(n);r&&null!==r.getProperties()&&t.push(r)}),t},remove:function(e){this.pref.remove(e),delete this.configs[e]},save:function(e,t){var n=t.getProperties(!0)||{},r=this._find(e,f);if(r){var i=r.getProperties(!0);Object.keys(i).forEach(function(e){Object.prototype.hasOwnProperty.call(n,e)&&n[e]===i[e]&&delete n[e]})}this.pref.put(e,n)}},t}(),c=function(){function e(e,n){n=t.clone(n),delete n[l],e.properties=n}function n(t,n,r,i,o){if(this.factory=t,this.store=n,this.readOnly=i,null!==r&&"object"==typeof r)this.pid=r[l],e(this,r);else{if("string"!=typeof r)throw new Error("Invalid pid/properties "+r);this.pid=r,this.properties=null}if(o){var s=this;Object.keys(o).forEach(function(e){e===l||Object.prototype.hasOwnProperty.call(s.properties,e)||(s.properties[e]=o[e])})}}return n.prototype={_checkReadOnly:function(){if(this.readOnly)throw new Error("Configuration is read only")},_checkRemoved:function(){if(this.removed)throw new Error("Configuration was removed")},getPid:function(){return this._checkRemoved(),this.pid},getProperties:function(e){this._checkRemoved();var n=null;return this.properties&&(n=t.clone(this.properties),e||(n[l]=this.pid)),n},remove:function(){this._checkReadOnly(),this._checkRemoved(),this.factory.notifyDeleted(this),this.store.remove(this.pid),this.removed=!0},update:function(t){this._checkReadOnly(),this._checkRemoved(),e(this,t),this.store.save(this.pid,this),this.factory.notifyUpdated(this)},toString:function(){return"[ConfigImpl pid: "+this.pid+", properties: "+JSON.stringify(this.properties)+"]"}},n}(),{ConfigurationAdminFactory:o}}),define("orion/bootstrap",["require","orion/Deferred","orion/serviceregistry","orion/preferences","orion/pluginregistry","orion/config"],function(e,t,n,r,i,o){function s(){if(u)return u;u=new t;var s=new n.ServiceRegistry,c=new r.PreferencesService(s);return c.getPreferences("/plugins").then(function(n){var r={plugins:{}};n.keys().forEach(function(t){var i=e.toUrl(t);r.plugins[i]=n[t]});var a=new i.PluginRegistry(s,r);return a.start().then(function(){return s.getServiceReferences("orion.core.preference.provider").length>0?c.getPreferences("/plugins",c.USER_SCOPE).then(function(n){var r=[];return n.keys().forEach(function(t){var n=e.toUrl(t);a.getPlugin(n)||r.push(a.installPlugin(n,{autostart:"lazy"}).then(function(e){return e.update().then(function(){return e.start({lazy:!0})})}))}),t.all(r,function(e){console.log(e)})}):void 0}).then(function(){return new o.ConfigurationAdminFactory(s,a,c).getConfigurationAdmin().then(s.registerService.bind(s,"orion.cm.configadmin"))}).then(function(){var e=s.getService("orion.core.auth");if(e){var t=e.getUser().then(function(t){return t?void localStorage.setItem("lastLogin",(new Date).getTime()):e.getAuthForm(window.location.href).then(function(e){setTimeout(function(){window.location=e},0)})}),n=localStorage.getItem("lastLogin");if(!n||n<(new Date).getTime()-9e5)return t}}).then(function(){var e={serviceRegistry:s,preferences:c,pluginRegistry:a};return u.resolve(e),e})})}var u;return{startup:s}}),define("domReady",[],function(){function e(e){var t;for(t=0;t<e.length;t+=1)e[t](a)}function t(){var t=f;c&&t.length&&(f=[],e(t))}function n(){c||(c=!0,s&&clearInterval(s),t())}function r(e){return c?e(a):f.push(e),r}var i,o,s,u="undefined"!=typeof window&&window.document,c=!u,a=u?document:null,f=[];if(u){if(document.addEventListener)document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1);else if(window.attachEvent){window.attachEvent("onload",n),o=document.createElement("div");try{i=null===window.frameElement}catch(l){}o.doScroll&&i&&window.external&&(s=setInterval(function(){try{o.doScroll(),n()}catch(e){}},30))}"complete"===document.readyState&&n()}return r.version="2.0.1",r.load=function(e,t,n,i){i.isBuild?n(null):r(n)},r}),define("index",["orion/browserCompatibility","orion/bootstrap","domReady!"],function(e,t){t.startup().then(function(){window.location="edit/edit.html"})});