!function(e,t){"function"==typeof define&&define.amd?define("orion/Deferred",t):"object"==typeof exports?module.exports=t():(e.orion=e.orion||{},e.orion.Deferred=t())}(this,function(){function e(){for(var e;e=i.shift();)e();s=!1}function t(e){i.push(e),s||(s=!0,u())}function r(e){return function(t){e(t)}}function n(e,t,n){try{var o=e(t),i=o&&("object"==typeof o||"function"==typeof o)&&o.then;if("function"==typeof i)if(o===n.promise)n.reject(new TypeError);else{var s=o.cancel;"function"==typeof s?n._parentCancel=s.bind(o):delete n._parentCancel,i.call(o,r(n.resolve),r(n.reject),r(n.progress))}else n.resolve(o)}catch(u){n.reject(u)}}function o(){function e(){for(var e;e=c.shift();){var t=e.deferred,r="fulfilled"===a?"resolve":"reject",o=e[r];"function"==typeof o?n(o,u,t):t[r](u)}}function r(r){delete f._parentCancel,a="rejected",u=r,c.length&&t(e)}function i(n){function s(e){return function(t){a&&"assumed"!==a||e(t)}}delete f._parentCancel;try{var l=n&&("object"==typeof n||"function"==typeof n)&&n.then;if("function"==typeof l)if(n===f)r(new TypeError);else{a="assumed";var p=n&&n.cancel;if("function"!=typeof p){var h=new o;n=h.promise;try{l(h.resolve,h.reject,h.progress)}catch(d){h.reject(d)}p=n.cancel,l=n.then}u=n,l.call(n,s(i),s(r)),f._parentCancel=p.bind(n)}else a="fulfilled",u=n,c.length&&t(e)}catch(m){s(r)(m)}}function s(){var e=f._parentCancel;if(e)delete f._parentCancel,e();else if(!a){var t=new Error("Cancel");t.name="Cancel",r(t)}}var u,a,c=[],f=this;this.resolve=function(e){return a||i(e),f},this.reject=function(e){return a||r(e),f},this.progress=function(e){return a||c.forEach(function(t){if(t.progress)try{t.progress(e)}catch(r){}}),f.promise},this.cancel=function(){return f._parentCancel?setTimeout(s,0):s(),f},this.then=function(r,n,i){var s=new o;return s._parentCancel=f.promise.cancel,c.push({resolve:r,reject:n,progress:i,deferred:s}),("fulfilled"===a||"rejected"===a)&&t(e),s.promise},this.promise={then:f.then,cancel:f.cancel}}var i=[],s=!1,u=function(){if("undefined"!=typeof process&&"function"==typeof process.nextTick){var t=process.nextTick;return function(){t(e)}}if("function"==typeof MutationObserver){var r=document.createElement("div"),n=new MutationObserver(e);return n.observe(r,{attributes:!0}),function(){r.setAttribute("class","_tick")}}return function(){setTimeout(e,0)}}();return o.all=function(e,t){function r(e,t){u||(s[e]=t,0===--i&&a.resolve(s))}function n(e,n){if(!u){if(t)try{return void r(e,t(n))}catch(o){n=o}a.reject(n)}}var i=e.length,s=[],u=!1,a=new o;return a.then(void 0,function(){u=!0,e.forEach(function(e){e.cancel&&e.cancel()})}),0===i?a.resolve(s):e.forEach(function(e,t){e.then(r.bind(void 0,t),n.bind(void 0,t))}),a.promise},o.when=function(e,t,r,n){var i,s;return e&&"function"==typeof e.then?i=e:(s=new o,s.resolve(e),i=s.promise),i.then(t,r,n)},o}),function(e,t){"function"==typeof define&&define.amd?define("orion/plugin",["orion/Deferred"],t):"object"==typeof exports?module.exports=t(require("orion/Deferred")):(e.orion=e.orion||{},e.orion.PluginProvider=t(e.orion.Deferred))}(this,function(e){function t(e,t){this.__objectId=e,this.__methods=t}function r(r){function n(e){w&&("undefined"==typeof ArrayBuffer&&(e=JSON.stringify(e)),w===self?w.postMessage(e):w.postMessage(e,"*"))}function o(){var e=[];return Object.keys(y).forEach(function(t){var r=y[t];e.push({serviceId:t,names:r.names,methods:r.methods,properties:r.properties})}),{headers:l||{},services:e}}function i(e,t){if(t&&t instanceof XMLHttpRequest){var r,n;try{r=t.status,n=t.statusText}catch(o){r=0,n=""}return{status:r||0,statusText:n}}return t}function s(e){var t=e?JSON.parse(JSON.stringify(e,i)):e;return e instanceof Error&&(t.__isError=!0,t.message=t.message||e.message,t.name=t.name||e.name),t}function u(r){if(!w)return(new e).reject(new Error("plugin not connected"));r.id=String(h++);var n=new e;g[r.id]=n,n.then(null,function(e){p&&e instanceof Error&&"Cancel"===e.name&&b({requestId:r.id,method:"cancel",params:e.message?[e.message]:[]})});var o=Object.prototype.toString;return r.params.forEach(function(e,i){if("[object Object]"===o.call(e)&&!(e instanceof t)){var s,u;for(s in e)"[object Function]"===o.call(e[s])&&(u=u||[],u.push(s));if(u){var a=d++;_[a]=e;var c=function(){delete _[a]};n.then(c,c),r.params[i]=new t(a,u)}}}),b(r),n.promise}function a(e,t){e||0===e?b({id:e,result:null,error:t}):console.log(t)}function c(e,t,r,n){n.forEach(function(e,t){if(e&&"undefined"!=typeof e.__objectId){var r={};e.__methods.forEach(function(t){r[t]=function(){return u({objectId:e.__objectId,method:t,params:Array.prototype.slice.call(arguments)})}}),n[t]=r}});var o="undefined"==typeof e?null:{id:e,result:null,error:null};try{var i=r.apply(t,n);if(!o)return;i&&"function"==typeof i.then?(v[e]=i,i.then(function(t){delete v[e],o.result=t,b(o)},function(t){v[e]&&(delete v[e],o.error=s(t),b(o))},function(){b({responseId:e,method:"progress",params:Array.prototype.slice.call(arguments)})})):(o.result=i,b(o))}catch(a){o&&(o.error=s(a),b(o))}}function f(e){if(e.source===w||"undefined"==typeof window){var t="string"!=typeof e.data?e.data:JSON.parse(e.data);try{if(t.method){var r=t.method,n=t.params||[];if("serviceId"in t){var o=y[t.serviceId];o||a(t.id,"service not found"),o=o.implementation,r in o?c(t.id,o,o[r],n):a(t.id,"method not found")}else if("objectId"in t){var i=_[t.objectId];i||a(t.id,"object not found"),!r in i?c(t.id,i,i[r],n):a(t.id,"method not found")}else if("requestId"in t){var s=v[t.requestId];s&&"cancel"===r&&s.cancel&&s.cancel.apply(s,n)}else{if(!("responseId"in t))throw new Error("Bad method: "+t.method);var u=g[t.responseId];u&&"progress"===r&&u.progress&&u.progress.apply(u,n)}}else{var f=g[String(t.id)];delete g[String(t.id)],t.error?f.reject(t.error):f.resolve(t.result)}}catch(l){console.log("Plugin._messageHandler "+l)}}}var l=r,p=!1,h=0,d=0,m=0,v={},g={},_={},y={},w=null;"undefined"==typeof window?w=self:window!==window.parent?w=window.parent:null!==window.opener&&(w=window.opener);var b=n;n({method:"loading"}),this.updateHeaders=function(e){if(p)throw new Error("Cannot update headers. Plugin Provider is connected");l=e},this.registerService=function(e,t,r){if(p)throw new Error("Cannot register service. Plugin Provider is connected");"string"==typeof e?e=[e]:Array.isArray(e)||(e=[]);var n=null,o=[];for(n in t)"function"==typeof t[n]&&o.push(n);y[m++]={names:e,methods:o,implementation:t,properties:r||{},listeners:{}}},this.registerServiceProvider=this.registerService,this.connect=function(e,t){if(p)return void(e&&e());if(!w)return void(t&&t("No valid plugin target"));addEventListener("message",f,!1);var r={method:"plugin",params:[o()]};n(r),p=!0,e&&e()},this.disconnect=function(){p&&(removeEventListener("message",f),w=null,p=!1)}}return r}),define("orion/xsrfUtils",[],function(){function e(){var e,t,r,o=document.cookie.split(";");for(e=0;e<o.length;e++)if(t=o[e].substr(0,o[e].indexOf("=")).trim(),r=o[e].substr(o[e].indexOf("=")+1).trim(),t==n)return r}function t(t){var r=e();r&&(t[n]=r)}function r(t){var r=e();r&&t.setRequestHeader(n,r)}var n="x-csrf-token";return{XSRF_TOKEN:n,getCSRFToken:e,setNonceHeader:t,addCSRFNonce:r}}),function(){function e(e){if("string"!=typeof e)throw new TypeError}function t(e){return e?e.split("&"):[]}function r(e){return 0===e.length?"":e.join("&")}function n(e){var t=/([^=]*)(?:=?)(.*)/.exec(e),r=t[1]?decodeURIComponent(t[1]):"",n=t[2]?decodeURIComponent(t[2]):"";return[r,n]}function o(e){var t=encodeURIComponent(e[0]);return e[1]&&(t+="="+encodeURIComponent(e[1])),t}function i(e,r){var o="",i=[],s=0;return{next:function(){if(o!==e.query&&(o=e.query,i=t(o)),s<i.length){var u=n(i[s++]);switch(r){case"keys":return u[0];case"values":return u[1];case"keys+values":return[u[0],u[1]];default:throw new TypeError}}throw T}}}function s(e){Object.defineProperty(this,"_url",{get:function(){return e._url}})}function u(e,t){if(!e.scheme&&t&&(e.scheme=t.scheme,!e.host&&t.host&&(e.userinfo=t.userinfo,e.host=t.host,e.port=t.port,e.pathRelative=!0)),e.pathRelative)if(e.path){if("/"!==e.path[0]){var r=/^(.*\/)[^\/]*$/.exec(t.path)[1]||"/";e.path=r+e.path}}else e.path=t.path}function a(e){return e.toLowerCase()}function c(e){return e?/[1-9]\d*$/.exec(e)[0]:""}function f(e){var t=[];return e.split("/").forEach(function(e){".."===e?t.pop():"."!==e&&t.push(e)}),t.join("/")}function l(e){e.scheme&&(e.scheme=a(e.scheme)),e.port&&(e.port=c(e.port)),e.host&&e.path&&(e.path=f(e.path))}function p(e){return e.replace(/\s/g,function(e){return"%"+e.charCodeAt(0).toString(16)})}function h(e,t){if("string"!=typeof e)throw new TypeError;e=p(e);var r=_.exec(e);if(!r)return null;var n={};if(n.scheme=r[1]||"",n.scheme&&!b.test(n.scheme))return null;var o=r[2];if(o){var i=y.exec(o);if(n.userinfo=i[1],n.host=i[2],n.port=i[3],n.port&&!R.test(n.port))return null}return n.path=r[3],n.query=r[4],n.fragment=r[5],u(n,t),l(n),n}function d(e){var t=e.scheme?e.scheme+":":"";return e.host&&(t+="//",e.userinfo&&(t+=e.userinfo+"@"),t+=e.host,e.port&&(t+=":"+e.port)),t+=e.path,e.query&&(t+="?"+e.query),e.fragment&&(t+="#"+e.fragment),t}function m(e,t){var r;if(t){if(t=t.href||t,r=h(t),!r||!r.scheme)throw new SyntaxError;Object.defineProperty(this,"_baseURL",{value:r})}var n=h(e,r);if(!n)throw new SyntaxError;Object.defineProperty(this,"_input",{value:e,writable:!0}),Object.defineProperty(this,"_url",{value:n,writable:!0});var o=new s(this);Object.defineProperty(this,"query",{get:function(){return this._url?o:null},enumerable:!0})}try{var v;if("function"==typeof window.URL&&0!==window.URL.length&&"http:"===(v=new window.URL("http://www.w3.org?q")).protocol&&v.query)return}catch(g){}var _=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/,y=/^(?:(.*)@)?(\[[^\]]*\]|[^:]*)(?::(.*))?$/,w=/^\S*$/,b=/^([a-zA-Z](?:[a-zA-Z0-9+-.])*)$/,R=/^\d*$/,U=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)$/,j=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)(?::(\d*))?$/,L=/^([^?#\s]*)$/,x=/^([^\s]*)$/,C=w,E=/([^:]*):?(.*)/,T="undefined"!=typeof StopIteration?StopIteration:new Error("Stop Iteration"),I={"ftp:":"21","gopher:":"70","http:":"80","https:":"443","ws:":"80","wss:":"443"};Object.defineProperties(s.prototype,{get:{value:function(r){e(r);var o,i=t(this._url.query);return i.some(function(e){var t=n(e);return t[0]===r?(o=t[1],!0):void 0}),o},enumerable:!0},set:{value:function(i,s){e(i),e(s);var u=t(this._url.query),a=u.some(function(e,t){var r=n(e);return r[0]===i?(r[1]=s,u[t]=o(r),!0):void 0});a||u.push(o([i,s])),this._url.query=r(u)},enumerable:!0},has:{value:function(r){e(r);var o=t(this._url.query);return o.some(function(e){var t=n(e);return t[0]===r?!0:void 0})},enumerable:!0},"delete":{value:function(o){e(o);var i=t(this._url.query),s=i.filter(function(e){var t=n(e);return t[0]!==o});return s.length!==i.length?(this._url.query=r(s),!0):!1},enumerable:!0},clear:{value:function(){this._url.query=""},enumerable:!0},forEach:{value:function(e,t){if("function"!=typeof e)throw new TypeError;var r=i(this._url,"keys+values");try{for(;;){var n=r.next();e.call(t,n[1],n[0],this)}}catch(o){if(o!==T)throw o}},enumerable:!0},keys:{value:function(){return i(this._url,"keys")},enumerable:!0},values:{value:function(){return i(this._url,"values")},enumerable:!0},items:{value:function(){return i(this._url,"keys+values")}},size:{get:function(){return t(this._url.query).length},enumerable:!0},getAll:{value:function(r){e(r);var o=[],i=t(this._url.query);return i.forEach(function(e){var t=n(e);t[0]===r&&o.push(t[1])}),o},enumerable:!0},append:{value:function(n,i){e(n),e(i);var s=t(this._url.query);s.push(o([n,i])),this._url.query=r(s)},enumerable:!0}}),Object.defineProperties(m.prototype,{href:{get:function(){return this._url?d(this._url):this._input},set:function(t){e(t),this._input=t,this._url=h(this._input,this._baseURL)},enumerable:!0},origin:{get:function(){return this._url&&this._url.host?this.protocol+"//"+this.host:""},enumerable:!0},protocol:{get:function(){return this._url?this._url.scheme+":":":"},set:function(t){if(e(t),this._url){var r=":"===t.slice(-1)?t.substring(0,t.length-1):t;(""===r||b.test(r))&&(this._url.scheme=a(r))}},enumerable:!0},_userinfo:{get:function(){return this._url?this._url.userinfo:""},set:function(t){e(t),this._url&&(this._url.userinfo=t)}},username:{get:function(){if(!this._url)return"";var e=E.exec(this._userinfo),t=decodeURIComponent(e[1]||"");return t},set:function(t){if(e(t),this._url){var r=E.exec(this._userinfo),n=[encodeURIComponent(t||"")];r[2]&&n.push(r[2]),this._userinfo=n.join(":")}},enumerable:!0},password:{get:function(){if(!this._url)return"";var e=E.exec(this._userinfo),t=decodeURIComponent(e[2]||"");return t},set:function(t){if(e(t),this._url){var r=E.exec(this._userinfo),n=[r[1]||""];t&&n.push(encodeURIComponent(t)),this._userinfo=n.join(":")}},enumerable:!0},host:{get:function(){var e="";return this._url&&this._url.host&&(e+=this._url.host,this._url.port&&(e+=":"+this._url.port)),e},set:function(t){if(e(t),this._url){var r=j.exec(t);r&&(this._url.host=r[1],this._url.port=c(r[2]))}},enumerable:!0},hostname:{get:function(){return this._url?this._url.host:""},set:function(t){if(e(t),this._url){var r=U.exec(t);r&&(this._url.host=t)}},enumerable:!0},port:{get:function(){var e=this._url?this._url.port||"":"";return e&&e===I[this.protocol]&&(e=""),e},set:function(t){if(e(t),this._url){var r=R.exec(t);r&&(this._url.port=c(t))}},enumerable:!0},pathname:{get:function(){return this._url?this._url.path:""},set:function(t){if(e(t),this._url){var r=L.exec(t);r&&(this._url.host&&t&&"/"!==t[0]&&(t="/"+t),this._url.path=t?f(t):"")}},enumerable:!0},search:{get:function(){return this._url&&this._url.query?"?"+this._url.query:""},set:function(t){if(e(t),this._url){t&&"?"===t[0]&&(t=t.substring(1));var r=x.exec(t);r&&(this._url.query=t)}},enumerable:!0},hash:{get:function(){return this._url&&this._url.fragment?"#"+this._url.fragment:""},set:function(t){if(e(t),this._url){t&&"#"===t[0]&&(t=t.substring(1));var r=C.exec(t);r&&(this._url.fragment=t)}},enumerable:!0}});var O=window.URL||window.webkitURL;O&&O.createObjectURL&&(Object.defineProperty(m,"createObjectURL",{value:O.createObjectURL.bind(O),enumerable:!1}),Object.defineProperty(m,"revokeObjectURL",{value:O.revokeObjectURL.bind(O),enumerable:!1})),window.URL=m}(),define("orion/URL-shim",function(){}),define("orion/xhr",["orion/Deferred","orion/xsrfUtils","orion/URL-shim"],function(e,t){function r(e,t,r,n){var o,i="undefined"!=typeof r.response?r.response:r.responseText,s="string"==typeof i?i:null;try{o=r.status}catch(u){o=0}var a={args:t,response:i,responseText:s,status:o,url:e,xhr:r};return"undefined"!=typeof n&&(a.error=n),a}function n(e){return new URL(location.href).origin===new URL(e,location.href).origin}function o(o,i,s){s=s||{};var u=arguments.length>3&&arguments[3]?arguments[3]:new XMLHttpRequest,a=new e,c=s.headers||{};n(i)&&t.setNonceHeader(c);var f,l=s.log||!1;"undefined"==typeof c["X-Requested-With"]&&(c["X-Requested-With"]="XMLHttpRequest"),"undefined"==typeof s.data||"POST"!==o&&"PUT"!==o||(f=s.data);var p=!1,h=!1;a.promise.then(void 0,function(e){p=!0,!h&&e instanceof Error&&"Cancel"===e.name&&u.abort()}),u.onabort=function(){if(h=!0,!p){var e=new Error("Cancel");e.name="Cancel",a.reject(e)}},u.onload=function(){var e=r(i,s,u);200<=u.status&&u.status<400?a.resolve(e):(a.reject(e),l&&"undefined"!=typeof console&&console.log(new Error(u.statusText)))},u.onerror=function(){var e=r(i,s,u);a.reject(e),l&&"undefined"!=typeof console&&console.log(new Error(u.statusText))},u.onprogress=function(e){e.xhr=u,a.progress(e)};try{if(u.open(o,i,!0),"string"==typeof s.responseType&&(u.responseType=s.responseType),"number"==typeof s.timeout)if("number"==typeof u.timeout)u.timeout=s.timeout,u.addEventListener("timeout",function(){a.reject(r(i,s,u,"Timeout exceeded"))});else{var d=setTimeout(function(){a.reject(r(i,s,u,"Timeout exceeded"))},s.timeout);a.promise.then(clearTimeout.bind(null,d),clearTimeout.bind(null,d))}Object.keys(c).forEach(function(e){u.setRequestHeader(e,c[e])}),u.send(f||null)}catch(m){a.reject(r(i,s,u,m))}return a.promise}return o}),define("orion/URITemplate",[],function(){function e(e){this._text=e}function t(e){return e.replace("%25","%")}function r(e,r){if("U"===r)return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()});if("U+R"===r)return encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(l,t);if("U+R-,"===r)return encodeURI(e).replace(/%5B/g,"[").replace(/%5D/g,"]").replace(/,/g,"%2C");throw new Error("Unknown allowed character set: "+r)}function n(e,t,n){for(var o=[],i=0;i<e.length;i++)"undefined"!=typeof e[i]&&o.push(r(e[i],t));return o.join(n)}function o(e,t,n,o){for(var i=Object.keys(e),s=[],u=0;u<i.length;u++)"undefined"!=typeof e[i[u]]&&s.push(r(i[u],t)+n+r(e[i[u]],t));return s.join(o)}function i(e){for(var t=[],r=e.split(","),n=0;n<r.length;n++){var o=r[n].match(f);if(null===o)throw new Error("Bad VarSpec: "+e);t.push({name:o[1],explode:!!o[2],prefix:o[3]?parseInt(o[3],10):-1})}return t}function s(e){if(0===e.length)throw new Error("Invalid Expression: 0 length expression");this._operator=c[e[0]],this._operator?e=e.substring(1):this._operator=c.NUL,this._varSpecList=i(e)}function u(t){for(var r=[],n=0,o=t.indexOf("{",n);-1!==o;){r.push(new e(t.substring(n,o)));var i=t.indexOf("}",o+1);if(-1===i)throw new Error("Invalid template: "+t);r.push(new s(t.substring(o+1,i))),n=i+1,o=t.indexOf("{",n)}return r.push(new e(t.substring(n))),r}function a(e){this._templateComponents=u(e)}var c={NUL:{first:"",sep:",",named:!1,ifemp:"",allow:"U"},"+":{first:"",sep:",",named:!1,ifemp:"",allow:"U+R"},".":{first:".",sep:",",named:!1,ifemp:"",allow:"U"},"/":{first:"/",sep:"/",named:!1,ifemp:"",allow:"U"},";":{first:";",sep:";",named:!0,ifemp:"",allow:"U"},"?":{first:"?",sep:"&",named:!0,ifemp:"=",allow:"U"},"&":{first:"&",sep:"&",named:!0,ifemp:"=",allow:"U"},"#":{first:"#",sep:",",named:!1,ifemp:"",allow:"U+R"},",":{first:"",sep:",",named:!1,ifemp:"",allow:"U+R-,"}},f=/^((?:(?:[a-zA-Z0-9_])|(?:%[0-9A-F][0-9A-F]))(?:(?:[a-zA-Z0-9_.])|(?:%[0-9A-F][0-9A-F]))*)(?:(\*)|:([0-9]+))?$/,l=/%25[0-9A-F][0-9A-F]/g;return e.prototype={expand:function(){return encodeURI(this._text)}},s.prototype={expand:function(e){for(var t=[],i=0;i<this._varSpecList.length;i++){var s=this._varSpecList[i],u=s.name,a=e[u],c=typeof a;if("undefined"!==c&&null!==a){var f=0===t.length?this._operator.first:this._operator.sep;if("string"===c)this._operator.named&&(f+=r(u,"U+R"),f+=0===a.length?this._operator.ifemp:"="),-1!==s.prefix&&s.prefix<a.length&&(a=a.substring(0,s.prefix)),f+=r(a,this._operator.allow);else if(Array.isArray(a)){if(0===a.length)continue;if(s.explode)f+=n(a,this._operator.allow,this._operator.sep);else{var l=n(a,this._operator.allow,",");this._operator.named&&(f+=r(u,"U+R"),f+=0===l.length?this._operator.ifemp:"="),f+=l}}else{if("object"!==c)throw new Error("bad param type: "+u+" : "+c);if(0===Object.keys(a).length)continue;if(s.explode)f+=o(a,this._operator.allow,"=",this._operator.sep);else{var p=o(a,this._operator.allow,",",",");this._operator.named&&(f+=r(u,"U+R"),f+=0===p.length?this._operator.ifemp:"="),f+=p}}t.push(f)}}return t.join("")}},a.prototype={expand:function(e){for(var t=[],r=0;r<this._templateComponents.length;r++)t.push(this._templateComponents[r].expand(e));return t.join("")}},a}),define("plugins/filePlugin/GerritFileImpl",["orion/xhr","orion/URITemplate","orion/Deferred","orion/URL-shim"],function(e,t,r){function n(e,r){this._listTemplate=new t(e+"/list{/project,ref,path:0}{+path}"),this._contentTemplate=new t(e+"/contents{/project,ref,path:0}{+path}"),this._repoURL=this._listTemplate.expand({project:r})}var o=/.*\/(?:contents|list)\/([^\/]*)(?:\/([^\/]*)(?:\/(.*))?)?/;return n.prototype={_handleError:function(e){var t="Unable to display repository contents at this time. Please try again later.",n="Warning",o={Severity:n,Message:t};return e.responseText=JSON.stringify(o),(new r).reject(e)},_getParents:function(e){var t=new URL(e),r=t.pathname.match(o),n=r[1]?decodeURIComponent(r[1]):r[1],i=r[2]?decodeURIComponent(r[2]):r[2],s=r[3]?decodeURIComponent(r[3]):r[3];if(!i)return null;var u=[];if(!s)return u;var a=s.split("/");a.pop();var c=this._listTemplate.expand({project:n,ref:i});u.push({Name:i.split("/").pop(),Location:c,ChildrenLocation:c});for(var f="",l=0;l<a.length;++l){var p=a[l];f+=p,c=this._listTemplate.expand({project:n,ref:i,path:f}),u.push({Name:p,Location:c,ChildrenLocation:c}),f+="/"}return u.reverse()},fetchChildren:function(t){var r=this;return e("GET",t,{headers:this._headers,timeout:15e3}).then(function(e){var t=JSON.parse(e.response);return t.map(function(e){var t="file"===e.type?r._contentTemplate:r._listTemplate,n=e.name.split("/").pop();""===e.path&&(e.path=null);var o=t.expand(e),i={Attributes:{Archive:!1,Hidden:!1,ReadOnly:!0,SymLink:!1},Location:o,Name:n,Length:"string"==typeof e.size?parseInt(e.size,10):e.size,LocalTimeStamp:e.LastCommit&&e.LastCommit.Author&&e.LastCommit.Author.Date?e.LastCommit.Author.Date:0,Directory:!1,LastCommit:e.LastCommit};return"file"!==e.type&&(i.Directory=!0,i.ChildrenLocation=o),i})},function(e){return r._handleError(e)})},loadWorkspaces:function(){return this.loadWorkspace(this._repoURL)},loadWorkspace:function(e){var t=this,r=new URL(e),n=r.pathname.match(o),i=n[2]?decodeURIComponent(n[2]):n[2],s=n[3]?decodeURIComponent(n[3]):n[3];return this.fetchChildren(e).then(function(r){var n={Attributes:{Archive:!1,Hidden:!1,ReadOnly:!0,SymLink:!1},Location:e,Name:null,Length:0,LocalTimeStamp:0,Directory:!0,ChildrenLocation:e,Children:r};return i?s?(n.Name=s.split("/").pop(),n.Parents=t._getParents(e)):(n.Name=i,n.Parents=[]):(n.Name="repo_root",n.Location=e,n.ChildrenLocation=e),n})},createProject:function(){throw"Not supported"},createFolder:function(){throw"Not supported"},createFile:function(){throw"Not supported"},deleteFile:function(){throw"Not supported"},moveFile:function(){throw"Not supported"},copyFile:function(){throw"Not supported"},read:function(t,r){if(r){var n=new URL(t),i=n.pathname.match(o),s=i[2]?decodeURIComponent(i[2]):i[2],u=this._getParents(t);if(!u)return{Attributes:{Archive:!1,Hidden:!1,ReadOnly:!0,SymLink:!1},Name:s||"",Location:t,Length:0,LocalTimeStamp:0,Parents:u,Directory:!0,ChildrenLocation:t};var a;return a=0===u.length?this._repoURL:u[0].Location,this.fetchChildren(a).then(function(e){var r;return e.some(function(e){return e.Location===t?(r=e,r.Parents=u,!0):void 0}),r})}var c=this;return e("GET",t,{timeout:15e3}).then(function(e){return e.responseText},function(e){return c._handleError(e)})},write:function(){throw"Not supported"},remoteImport:function(){throw"Not supported"},remoteExport:function(){throw"Not supported"},readBlob:function(t){var r=this;return e("GET",t,{responseType:"arraybuffer",timeout:15e3}).then(function(e){return e.response},function(e){return r._handleError(e)})},writeBlob:function(){throw"Not supported"}},n.prototype.constructor=n,n}),define("plugins/GerritFilePlugin",["orion/plugin","orion/Deferred","plugins/filePlugin/GerritFileImpl","orion/URL-shim"],function(e,t,r){var n={name:"Gerrit File Plugin",version:"1.0",description:"Gerrit File Plugin"},o=new e(n),i=new URL(window.location.href),s=i.query.get("project"),u=new URL("../..",i);u.search="";var a=new r(u.href,s);o.registerService("orion.core.file",a,{Name:"Gerrit File contents",top:a._repoURL,pattern:u.href.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}),o.connect()});