!function(e,t){"function"==typeof define&&define.amd?define("orion/Deferred",t):"object"==typeof exports?module.exports=t():(e.orion=e.orion||{},e.orion.Deferred=t())}(this,function(){function e(){for(var e;e=i.shift();)e();s=!1}function t(e){i.push(e),s||(s=!0,a())}function r(e){return function(t){e(t)}}function n(e,t,n){try{var o=e(t),i=o&&("object"==typeof o||"function"==typeof o)&&o.then;if("function"==typeof i)if(o===n.promise)n.reject(new TypeError);else{var s=o.cancel;"function"==typeof s?n._parentCancel=s.bind(o):delete n._parentCancel,i.call(o,r(n.resolve),r(n.reject),r(n.progress))}else n.resolve(o)}catch(a){n.reject(a)}}function o(){function e(){for(var e;e=c.shift();){var t=e.deferred,r="fulfilled"===u?"resolve":"reject",o=e[r];"function"==typeof o?n(o,a,t):t[r](a)}}function r(r){delete h._parentCancel,u="rejected",a=r,c.length&&t(e)}function i(n){function s(e){return function(t){u&&"assumed"!==u||e(t)}}delete h._parentCancel;try{var f=n&&("object"==typeof n||"function"==typeof n)&&n.then;if("function"==typeof f)if(n===h)r(new TypeError);else{u="assumed";var l=n&&n.cancel;if("function"!=typeof l){var d=new o;n=d.promise;try{f(d.resolve,d.reject,d.progress)}catch(p){d.reject(p)}l=n.cancel,f=n.then}a=n,f.call(n,s(i),s(r)),h._parentCancel=l.bind(n)}else u="fulfilled",a=n,c.length&&t(e)}catch(m){s(r)(m)}}function s(){var e=h._parentCancel;if(e)delete h._parentCancel,e();else if(!u){var t=new Error("Cancel");t.name="Cancel",r(t)}}var a,u,c=[],h=this;this.resolve=function(e){return u||i(e),h},this.reject=function(e){return u||r(e),h},this.progress=function(e){return u||c.forEach(function(t){if(t.progress)try{t.progress(e)}catch(r){}}),h.promise},this.cancel=function(){return h._parentCancel?setTimeout(s,0):s(),h},this.then=function(r,n,i){var s=new o;return s._parentCancel=h.promise.cancel,c.push({resolve:r,reject:n,progress:i,deferred:s}),("fulfilled"===u||"rejected"===u)&&t(e),s.promise},this.promise={then:h.then,cancel:h.cancel}}var i=[],s=!1,a=function(){if("undefined"!=typeof process&&"function"==typeof process.nextTick){var t=process.nextTick;return function(){t(e)}}if("function"==typeof MutationObserver){var r=document.createElement("div"),n=new MutationObserver(e);return n.observe(r,{attributes:!0}),function(){r.setAttribute("class","_tick")}}return function(){setTimeout(e,0)}}();return o.all=function(e,t){function r(e,t){a||(s[e]=t,0===--i&&u.resolve(s))}function n(e,n){if(!a){if(t)try{return void r(e,t(n))}catch(o){n=o}u.reject(n)}}var i=e.length,s=[],a=!1,u=new o;return u.then(void 0,function(){a=!0,e.forEach(function(e){e.cancel&&e.cancel()})}),0===i?u.resolve(s):e.forEach(function(e,t){e.then(r.bind(void 0,t),n.bind(void 0,t))}),u.promise},o.when=function(e,t,r,n){var i,s;return e&&"function"==typeof e.then?i=e:(s=new o,s.resolve(e),i=s.promise),i.then(t,r,n)},o}),function(e,t){"function"==typeof define&&define.amd?define("orion/plugin",["orion/Deferred"],t):"object"==typeof exports?module.exports=t(require("orion/Deferred")):(e.orion=e.orion||{},e.orion.PluginProvider=t(e.orion.Deferred))}(this,function(e){function t(e,t){this.__objectId=e,this.__methods=t}function r(r){function n(e){b&&("undefined"==typeof ArrayBuffer&&(e=JSON.stringify(e)),b===self?b.postMessage(e):b.postMessage(e,"*"))}function o(){var e=[];return Object.keys(y).forEach(function(t){var r=y[t];e.push({serviceId:t,names:r.names,methods:r.methods,properties:r.properties})}),{headers:f||{},services:e}}function i(e,t){if(t&&t instanceof XMLHttpRequest){var r,n;try{r=t.status,n=t.statusText}catch(o){r=0,n=""}return{status:r||0,statusText:n}}return t}function s(e){var t=e?JSON.parse(JSON.stringify(e,i)):e;return e instanceof Error&&(t.__isError=!0,t.message=t.message||e.message,t.name=t.name||e.name),t}function a(r){if(!b)return(new e).reject(new Error("plugin not connected"));r.id=String(d++);var n=new e;_[r.id]=n,n.then(null,function(e){l&&e instanceof Error&&"Cancel"===e.name&&w({requestId:r.id,method:"cancel",params:e.message?[e.message]:[]})});var o=Object.prototype.toString;return r.params.forEach(function(e,i){if("[object Object]"===o.call(e)&&!(e instanceof t)){var s,a;for(s in e)"[object Function]"===o.call(e[s])&&(a=a||[],a.push(s));if(a){var u=p++;g[u]=e;var c=function(){delete g[u]};n.then(c,c),r.params[i]=new t(u,a)}}}),w(r),n.promise}function u(e,t){e||0===e?w({id:e,result:null,error:t}):console.log(t)}function c(e,t,r,n){n.forEach(function(e,t){if(e&&"undefined"!=typeof e.__objectId){var r={};e.__methods.forEach(function(t){r[t]=function(){return a({objectId:e.__objectId,method:t,params:Array.prototype.slice.call(arguments)})}}),n[t]=r}});var o="undefined"==typeof e?null:{id:e,result:null,error:null};try{var i=r.apply(t,n);if(!o)return;i&&"function"==typeof i.then?(v[e]=i,i.then(function(t){delete v[e],o.result=t,w(o)},function(t){v[e]&&(delete v[e],o.error=s(t),w(o))},function(){w({responseId:e,method:"progress",params:Array.prototype.slice.call(arguments)})})):(o.result=i,w(o))}catch(u){o&&(o.error=s(u),w(o))}}function h(e){if(e.source===b||"undefined"==typeof window){var t="string"!=typeof e.data?e.data:JSON.parse(e.data);try{if(t.method){var r=t.method,n=t.params||[];if("serviceId"in t){var o=y[t.serviceId];o||u(t.id,"service not found"),o=o.implementation,r in o?c(t.id,o,o[r],n):u(t.id,"method not found")}else if("objectId"in t){var i=g[t.objectId];i||u(t.id,"object not found"),!r in i?c(t.id,i,i[r],n):u(t.id,"method not found")}else if("requestId"in t){var s=v[t.requestId];s&&"cancel"===r&&s.cancel&&s.cancel.apply(s,n)}else{if(!("responseId"in t))throw new Error("Bad method: "+t.method);var a=_[t.responseId];a&&"progress"===r&&a.progress&&a.progress.apply(a,n)}}else{var h=_[String(t.id)];delete _[String(t.id)],t.error?h.reject(t.error):h.resolve(t.result)}}catch(f){console.log("Plugin._messageHandler "+f)}}}var f=r,l=!1,d=0,p=0,m=0,v={},_={},g={},y={},b=null;"undefined"==typeof window?b=self:window!==window.parent?b=window.parent:null!==window.opener&&(b=window.opener);var w=n;n({method:"loading"}),this.updateHeaders=function(e){if(l)throw new Error("Cannot update headers. Plugin Provider is connected");f=e},this.registerService=function(e,t,r){if(l)throw new Error("Cannot register service. Plugin Provider is connected");"string"==typeof e?e=[e]:Array.isArray(e)||(e=[]);var n=null,o=[];for(n in t)"function"==typeof t[n]&&o.push(n);y[m++]={names:e,methods:o,implementation:t,properties:r||{},listeners:{}}},this.registerServiceProvider=this.registerService,this.connect=function(e,t){if(l)return void(e&&e());if(!b)return void(t&&t("No valid plugin target"));addEventListener("message",h,!1);var r={method:"plugin",params:[o()]};n(r),l=!0,e&&e()},this.disconnect=function(){l&&(removeEventListener("message",h),b=null,l=!1)}}return r}),define("orion/xsrfUtils",[],function(){function e(){var e,t,r,o=document.cookie.split(";");for(e=0;e<o.length;e++)if(t=o[e].substr(0,o[e].indexOf("=")).trim(),r=o[e].substr(o[e].indexOf("=")+1).trim(),t==n)return r}function t(t){var r=e();r&&(t[n]=r)}function r(t){var r=e();r&&t.setRequestHeader(n,r)}var n="x-csrf-token";return{XSRF_TOKEN:n,getCSRFToken:e,setNonceHeader:t,addCSRFNonce:r}}),function(){function e(e){if("string"!=typeof e)throw new TypeError}function t(e){return e?e.split("&"):[]}function r(e){return 0===e.length?"":e.join("&")}function n(e){var t=/([^=]*)(?:=?)(.*)/.exec(e),r=t[1]?decodeURIComponent(t[1]):"",n=t[2]?decodeURIComponent(t[2]):"";return[r,n]}function o(e){var t=encodeURIComponent(e[0]);return e[1]&&(t+="="+encodeURIComponent(e[1])),t}function i(e,r){var o="",i=[],s=0;return{next:function(){if(o!==e.query&&(o=e.query,i=t(o)),s<i.length){var a=n(i[s++]);switch(r){case"keys":return a[0];case"values":return a[1];case"keys+values":return[a[0],a[1]];default:throw new TypeError}}throw P}}}function s(e){Object.defineProperty(this,"_url",{get:function(){return e._url}})}function a(e,t){if(!e.scheme&&t&&(e.scheme=t.scheme,!e.host&&t.host&&(e.userinfo=t.userinfo,e.host=t.host,e.port=t.port,e.pathRelative=!0)),e.pathRelative)if(e.path){if("/"!==e.path[0]){var r=/^(.*\/)[^\/]*$/.exec(t.path)[1]||"/";e.path=r+e.path}}else e.path=t.path}function u(e){return e.toLowerCase()}function c(e){return e?/[1-9]\d*$/.exec(e)[0]:""}function h(e){var t=[];return e.split("/").forEach(function(e){".."===e?t.pop():"."!==e&&t.push(e)}),t.join("/")}function f(e){e.scheme&&(e.scheme=u(e.scheme)),e.port&&(e.port=c(e.port)),e.host&&e.path&&(e.path=h(e.path))}function l(e){return e.replace(/\s/g,function(e){return"%"+e.charCodeAt(0).toString(16)})}function d(e,t){if("string"!=typeof e)throw new TypeError;e=l(e);var r=g.exec(e);if(!r)return null;var n={};if(n.scheme=r[1]||"",n.scheme&&!w.test(n.scheme))return null;var o=r[2];if(o){var i=y.exec(o);if(n.userinfo=i[1],n.host=i[2],n.port=i[3],n.port&&!L.test(n.port))return null}return n.path=r[3],n.query=r[4],n.fragment=r[5],a(n,t),f(n),n}function p(e){var t=e.scheme?e.scheme+":":"";return e.host&&(t+="//",e.userinfo&&(t+=e.userinfo+"@"),t+=e.host,e.port&&(t+=":"+e.port)),t+=e.path,e.query&&(t+="?"+e.query),e.fragment&&(t+="#"+e.fragment),t}function m(e,t){var r;if(t){if(t=t.href||t,r=d(t),!r||!r.scheme)throw new SyntaxError;Object.defineProperty(this,"_baseURL",{value:r})}var n=d(e,r);if(!n)throw new SyntaxError;Object.defineProperty(this,"_input",{value:e,writable:!0}),Object.defineProperty(this,"_url",{value:n,writable:!0});var o=new s(this);Object.defineProperty(this,"query",{get:function(){return this._url?o:null},enumerable:!0})}try{var v;if("function"==typeof window.URL&&0!==window.URL.length&&"http:"===(v=new window.URL("http://www.w3.org?q")).protocol&&v.query)return}catch(_){}var g=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/,y=/^(?:(.*)@)?(\[[^\]]*\]|[^:]*)(?::(.*))?$/,b=/^\S*$/,w=/^([a-zA-Z](?:[a-zA-Z0-9+-.])*)$/,L=/^\d*$/,R=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)$/,C=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)(?::(\d*))?$/,U=/^([^?#\s]*)$/,j=/^([^\s]*)$/,E=b,S=/([^:]*):?(.*)/,P="undefined"!=typeof StopIteration?StopIteration:new Error("Stop Iteration"),O={"ftp:":"21","gopher:":"70","http:":"80","https:":"443","ws:":"80","wss:":"443"};Object.defineProperties(s.prototype,{get:{value:function(r){e(r);var o,i=t(this._url.query);return i.some(function(e){var t=n(e);return t[0]===r?(o=t[1],!0):void 0}),o},enumerable:!0},set:{value:function(i,s){e(i),e(s);var a=t(this._url.query),u=a.some(function(e,t){var r=n(e);return r[0]===i?(r[1]=s,a[t]=o(r),!0):void 0});u||a.push(o([i,s])),this._url.query=r(a)},enumerable:!0},has:{value:function(r){e(r);var o=t(this._url.query);return o.some(function(e){var t=n(e);return t[0]===r?!0:void 0})},enumerable:!0},"delete":{value:function(o){e(o);var i=t(this._url.query),s=i.filter(function(e){var t=n(e);return t[0]!==o});return s.length!==i.length?(this._url.query=r(s),!0):!1},enumerable:!0},clear:{value:function(){this._url.query=""},enumerable:!0},forEach:{value:function(e,t){if("function"!=typeof e)throw new TypeError;var r=i(this._url,"keys+values");try{for(;;){var n=r.next();e.call(t,n[1],n[0],this)}}catch(o){if(o!==P)throw o}},enumerable:!0},keys:{value:function(){return i(this._url,"keys")},enumerable:!0},values:{value:function(){return i(this._url,"values")},enumerable:!0},items:{value:function(){return i(this._url,"keys+values")}},size:{get:function(){return t(this._url.query).length},enumerable:!0},getAll:{value:function(r){e(r);var o=[],i=t(this._url.query);return i.forEach(function(e){var t=n(e);t[0]===r&&o.push(t[1])}),o},enumerable:!0},append:{value:function(n,i){e(n),e(i);var s=t(this._url.query);s.push(o([n,i])),this._url.query=r(s)},enumerable:!0}}),Object.defineProperties(m.prototype,{href:{get:function(){return this._url?p(this._url):this._input},set:function(t){e(t),this._input=t,this._url=d(this._input,this._baseURL)},enumerable:!0},origin:{get:function(){return this._url&&this._url.host?this.protocol+"//"+this.host:""},enumerable:!0},protocol:{get:function(){return this._url?this._url.scheme+":":":"},set:function(t){if(e(t),this._url){var r=":"===t.slice(-1)?t.substring(0,t.length-1):t;(""===r||w.test(r))&&(this._url.scheme=u(r))}},enumerable:!0},_userinfo:{get:function(){return this._url?this._url.userinfo:""},set:function(t){e(t),this._url&&(this._url.userinfo=t)}},username:{get:function(){if(!this._url)return"";var e=S.exec(this._userinfo),t=decodeURIComponent(e[1]||"");return t},set:function(t){if(e(t),this._url){var r=S.exec(this._userinfo),n=[encodeURIComponent(t||"")];r[2]&&n.push(r[2]),this._userinfo=n.join(":")}},enumerable:!0},password:{get:function(){if(!this._url)return"";var e=S.exec(this._userinfo),t=decodeURIComponent(e[2]||"");return t},set:function(t){if(e(t),this._url){var r=S.exec(this._userinfo),n=[r[1]||""];t&&n.push(encodeURIComponent(t)),this._userinfo=n.join(":")}},enumerable:!0},host:{get:function(){var e="";return this._url&&this._url.host&&(e+=this._url.host,this._url.port&&(e+=":"+this._url.port)),e},set:function(t){if(e(t),this._url){var r=C.exec(t);r&&(this._url.host=r[1],this._url.port=c(r[2]))}},enumerable:!0},hostname:{get:function(){return this._url?this._url.host:""},set:function(t){if(e(t),this._url){var r=R.exec(t);r&&(this._url.host=t)}},enumerable:!0},port:{get:function(){var e=this._url?this._url.port||"":"";return e&&e===O[this.protocol]&&(e=""),e},set:function(t){if(e(t),this._url){var r=L.exec(t);r&&(this._url.port=c(t))}},enumerable:!0},pathname:{get:function(){return this._url?this._url.path:""},set:function(t){if(e(t),this._url){var r=U.exec(t);r&&(this._url.host&&t&&"/"!==t[0]&&(t="/"+t),this._url.path=t?h(t):"")}},enumerable:!0},search:{get:function(){return this._url&&this._url.query?"?"+this._url.query:""},set:function(t){if(e(t),this._url){t&&"?"===t[0]&&(t=t.substring(1));var r=j.exec(t);r&&(this._url.query=t)}},enumerable:!0},hash:{get:function(){return this._url&&this._url.fragment?"#"+this._url.fragment:""},set:function(t){if(e(t),this._url){t&&"#"===t[0]&&(t=t.substring(1));var r=E.exec(t);r&&(this._url.fragment=t)}},enumerable:!0}});var T=window.URL||window.webkitURL;T&&T.createObjectURL&&(Object.defineProperty(m,"createObjectURL",{value:T.createObjectURL.bind(T),enumerable:!1}),Object.defineProperty(m,"revokeObjectURL",{value:T.revokeObjectURL.bind(T),enumerable:!1})),window.URL=m}(),define("orion/URL-shim",function(){}),define("orion/xhr",["orion/Deferred","orion/xsrfUtils","orion/URL-shim"],function(e,t){function r(e,t,r,n){var o,i="undefined"!=typeof r.response?r.response:r.responseText,s="string"==typeof i?i:null;try{o=r.status}catch(a){o=0}var u={args:t,response:i,responseText:s,status:o,url:e,xhr:r};return"undefined"!=typeof n&&(u.error=n),u}function n(e){return new URL(location.href).origin===new URL(e,location.href).origin}function o(o,i,s){s=s||{};var a=arguments.length>3&&arguments[3]?arguments[3]:new XMLHttpRequest,u=new e,c=s.headers||{};n(i)&&t.setNonceHeader(c);var h,f=s.log||!1;"undefined"==typeof c["X-Requested-With"]&&(c["X-Requested-With"]="XMLHttpRequest"),"undefined"==typeof s.data||"POST"!==o&&"PUT"!==o||(h=s.data);var l=!1,d=!1;u.promise.then(void 0,function(e){l=!0,!d&&e instanceof Error&&"Cancel"===e.name&&a.abort()}),a.onabort=function(){if(d=!0,!l){var e=new Error("Cancel");e.name="Cancel",u.reject(e)}},a.onload=function(){var e=r(i,s,a);200<=a.status&&a.status<400?u.resolve(e):(u.reject(e),f&&"undefined"!=typeof console&&console.log(new Error(a.statusText)))},a.onerror=function(){var e=r(i,s,a);u.reject(e),f&&"undefined"!=typeof console&&console.log(new Error(a.statusText))},a.onprogress=function(e){e.xhr=a,u.progress(e)};try{if(a.open(o,i,!0),"string"==typeof s.responseType&&(a.responseType=s.responseType),"number"==typeof s.timeout)if("number"==typeof a.timeout)a.timeout=s.timeout,a.addEventListener("timeout",function(){u.reject(r(i,s,a,"Timeout exceeded"))});else{var p=setTimeout(function(){u.reject(r(i,s,a,"Timeout exceeded"))},s.timeout);u.promise.then(clearTimeout.bind(null,p),clearTimeout.bind(null,p))}Object.keys(c).forEach(function(e){a.setRequestHeader(e,c[e])}),a.send(h||null)}catch(m){u.reject(r(i,s,a,m))}return u.promise}return o}),define("orion/Base64",[],function(){function e(e){e=e instanceof Uint8Array?e:new Uint8Array(e);for(var t=[],r=0,n=e.length;n>r;r+=65536)t.push(String.fromCharCode.apply(null,e.subarray(r,Math.min(n,r+65536))));return btoa(t.join(""))}function t(e){e=String(void 0!==e?e:""),r||(e=e.replace(/\s/g,""));for(var t=atob(e),n=t.length,o=new Uint8Array(n),i=0;n>i;i++)o[i]=t.charCodeAt(i);return o}var r=function(){try{return atob("AA==")===atob("A A = =")}catch(e){return!1}}();return{encode:e,decode:t}}),function(e){function t(){Error.apply(this,arguments)}function r(e,t,r){return e>=t&&r>=e}function n(e,t){var r=e||"utf-8";if("utf-8"!==r&&"utf8"!==r&&"unicode-1-1-utf-8"!==r)throw new TypeError("only utf-8 supported");Object.defineProperties(this,{encoding:{value:r,enumerable:!0},_fatal:{value:t&&t.fatal},_saved:{value:[],writable:!0},_checkBOM:{value:!0,writable:!0}})}function o(e){var t=e||"utf-8";if("utf-8"!==t&&"utf8"!==t&&"unicode-1-1-utf-8"!==t)throw new TypeError("only utf-8 supported");Object.defineProperties(this,{encoding:{value:t,enumerable:!0},_saved:{value:null,writable:!0}})}t.prototype=new Error,t.prototype.constructor=t,t.prototype.name="EncodingError",n.prototype.decode=function(e,n){function o(){if(this._fatal)throw this._saved.length=f=0,p=d,this._checkBOM=this._checkBOM||!h,new t;m[v++]=65533}e=e instanceof Uint8Array?e:new Uint8Array(e);var i,s,a,u,c,h=n&&n.stream,f=this._saved.length,l=e.length,d=0,p=0,m=new Uint16Array(l+f),v=0;if(this._checkBOM&&l)if(f+l>2){for(var _=f;3>_;_++)this._saved.push(e[d++]);239!==this._saved[0]||187!==this._saved[1]||191!==this._saved[2]?(d=0,this._saved.length=f):f=this._saved.length-=3,this._checkBOM=!1}else if(h)for(;l>d;)this._saved.push(e[d++]);for(;l>d;){if(i=f>0?this._saved[0]:e[d++],128>i)m[v++]=i;else if(r(i,194,223)){if(d===l)break;if(s=f>1?this._saved[1]:e[d++],!r(s,128,191)){o();continue}m[v++]=(31&i)<<6|63&s}else if(r(i,224,239)){if(d===l)break;if(s=f>1?this._saved[1]:e[d++],224===i&&!r(s,160,191)||237===i&&!r(s,128,159)||!r(s,128,191)){o();continue}if(d===l)break;if(a=f>2?this._saved[2]:e[d++],!r(a,128,191)){o();continue}m[v++]=(15&i)<<12|(63&s)<<6|63&a}else if(r(i,240,244)){if(d===l)break;if(s=f>1?this._saved[1]:e[d++],240===i&&!r(s,144,191)||244===i&&!r(s,128,143)||!r(s,128,191)){o();continue}if(d===l)break;if(a=f>2?this._saved[2]:e[d++],!r(a,128,191)){o();continue}if(d===l)break;if(u=e[d++],!r(u,128,191)){o();continue}c=65535&((7&i)<<18|(63&s)<<12|(63&a)<<6|63&u),m[v++]=c>>10|55296,m[v++]=1023&c|56320}else o();p=d,f&&(this._saved.length=f=0)}for(;p!==d;)this._saved.push(e[p++]);if(this._checkBOM=this._checkBOM||!h,!h&&0!==this._saved.length)throw new t;for(var g=[],y=0;v>y;y+=65536)g.push(String.fromCharCode.apply(null,m.subarray(y,Math.min(v,y+65536))));return g.join("")},o.prototype.encode=function(e,n){e=String(void 0!==e?e:"");for(var o,i,s,a=n&&n.stream,u=e.length,c=0,h=new Uint8Array(3*(u+(null===this._saved?0:1))),f=0;u>c;)if(null===this._saved?o=e.charCodeAt(c++):(o=this._saved,this._saved=null),128>o)h[f++]=o;else if(2048>o)h[f++]=192|o>>6,h[f++]=128|63&o;else if(55296>o||o>56319)h[f++]=224|o>>12,h[f++]=128|o>>6&63,h[f++]=128|63&o;else{if(!(u>c)){if(a){this._saved=o;break}throw new t}if(i=e.charCodeAt(c++),!r(i,56320,57343))throw new t;s=65536|(1023&o)<<10|1023&i,h[f++]=240|s>>18,h[f++]=128|s>>12&63,h[f++]=128|s>>6&63,h[f++]=128|63&s}if(!a&&null!==this._saved)throw new t;return h.buffer.slice?new Uint8Array(h.buffer.slice(0,f)):h.subarray(0,f)},e.TextDecoder=e.TextDecoder||n,e.TextEncoder=e.TextEncoder||o}("undefined"==typeof global?this||self:global),define("orion/encoding-shim",function(){}),define("plugins/filePlugin/GitHubFileImpl",["orion/Deferred","orion/xhr","orion/Base64","orion/encoding-shim","orion/URL-shim"],function(e,t,r){function n(e,t){this._originalRepoURL=e;var r=e.match(/https\:\/\/github\.com(?:\:443)?\/([^/]+)\/([^/]+).git$/);if(!r)throw"Bad Github repository url "+e;this._repoURL=new URL("https://api.github.com/repos/"+r[1]+"/"+r[2]),this._commitURLBase="https://github.com/"+r[1]+"/"+r[2]+"/commit/",this._contentsPath=this._repoURL.pathname+"/contents",this._headers={Accept:"application/vnd.github.v3+json"},t?(this._headers.Authorization="token "+t,o=3):o=2}var o=1,i=!0;return n.prototype={_getBranchName:function(e){var t=new URL(e),r=t.pathname;if(0===r.indexOf(this._contentsPath)){var n=r.substring(this._contentsPath.length),o=n.match(/\!([^\/]+)(.*)/);if(o&&o[1])return o[1]}return"master"},_refPathToQuery:function(e){var t=new URL(e),r=t.pathname;if(0===r.indexOf(this._contentsPath)){var n=r.substring(this._contentsPath.length),o=n.match(/\!([^\/]+)(.*)/);o&&(t.query.set("ref",decodeURIComponent(o[1])),t.pathname=this._contentsPath+o[2],e=t.href)}return e},_refQueryToPath:function(e){var t=new URL(e),r=t.pathname,n=t.query.get("ref")||"master";if(n&&0===r.indexOf(this._contentsPath)){var o=r.substring(this._contentsPath.length);t.query.delete("ref"),t.pathname=this._contentsPath+"!"+encodeURIComponent(n)+o,e=t.href}return e},_handleError:function(t,r){var n="Unknown",o="Warning";if("Cancel"===t.name)return(new e).reject(t);n=t.status&&404===t.status?r?"This is a private GitHub project. Authorized users can view the source on the [GitHub repository page]("+this._originalRepoURL+").":"Bad URL("+(t.url?t.url:"")+").":t.status&&403===t.status?"GitHub is currently limiting our ability to display repository contents. Wait a while and then refresh the browser to try again or go to the [GitHub repository page]("+this._originalRepoURL+").":"Unable to display repository contents at this time. Refresh the browser to try again.";var i={Severity:o,Message:n};return t.responseText=JSON.stringify(i),(new e).reject(t)},_getBranches:function(){var e=this;return t("GET",this._repoURL.href+"/branches?per_page=1000",{headers:this._headers,timeout:15e3}).then(function(t){var r=JSON.parse(t.response);return r.map(function(t){var r=e._repoURL.href+"/contents!"+encodeURIComponent(t.name);return{Attributes:{Archive:!1,Hidden:!1,ReadOnly:!0,SymLink:!1},Location:r,Name:t.name,Length:0,LocalTimeStamp:0,Directory:!0,ChildrenLocation:r,Sha:t.commit?t.commit.sha:null}})},function(t){return e._handleError(t,!0)})},_getChildren:function(e){e=this._refPathToQuery(e);var r=this;return t("GET",e,{headers:this._headers,timeout:15e3}).then(function(e){var t=JSON.parse(e.response);return t.map(function(e){var t=r._refQueryToPath(e.url),n={Attributes:{Archive:!1,Hidden:!1,ReadOnly:!0,SymLink:!1},Location:t,Name:e.name,Length:e.size,LocalTimeStamp:0,Directory:!1,Sha:e.sha,CommitPath:e.path};return"dir"===e.type&&(n.Directory=!0,n.ChildrenLocation=t),n})},function(e){return r._handleError(e)})},_getParents:function(e){if(e===this._repoURL.href)return null;var t=new URL(e),r=t.pathname,n=[],o=r.substring(this._contentsPath.length),i=o.split("/");if(i.pop(),0===i.length)return n;var s=i.shift();t.pathname=this._contentsPath+s,n.push({Name:decodeURIComponent(s.substring(1)),Location:t.href,ChildrenLocation:t.href});for(var a=0;a<i.length;++a){var u=i[a],c=decodeURIComponent(i[a]);t.pathname+="/"+u,n.push({Name:c,Location:t.href,ChildrenLocation:t.href})}return n.reverse()},_readGitBlob:function(e,r){var n=this;return e&&e.Sha&&!e.Directory&&(!e.Length||"number"==typeof e.Length&&e.Length>=1048576)?t("GET",n._repoURL.href+"/git/blobs/"+e.Sha,{headers:this._headers,timeout:15e3}).then(function(e){var t=JSON.parse(e.response);return t},function(e){return n._handleError(e)}):r?n._handleError(r):e},_retryBlob:function(e,t){var n=this;return this.read(e,!0).then(function(e){return n._readGitBlob(e,t).then(function(e){return e.content&&e.size?r.decode(e.content):void n._handleError(t)})})},_getSHAObject:function(t){var r=this,n=this._getParents(t);return n?0===n.length?r._getBranches().then(function(e){var r;return e.some(function(e){return e.Location===t?(r=e,!0):void 0}),r}):r.read(t,!0).then(function(e){return e}):(new e).resolve()},_injectCommitInfo:function(e,r,n){var o=this,s=n?r:r+"&path="+e.CommitPath;return t("GET",o._repoURL.href+"/commits?sha="+s+"&per_page=1",{headers:this._headers,timeout:15e3}).then(function(t){var r=JSON.parse(t.response);return r.length>0&&r[0].commit&&r[0].commit.author&&r[0].commit.author.date&&(e.LocalTimeStamp=r[0].commit.author.date,e.LastCommit={},e.LastCommit.Author={},e.LastCommit.Author.Date=r[0].commit.author.date,e.LastCommit.Author.Name=r[0].commit.author.name?r[0].commit.author.name:"",e.LastCommit.Author.Email=r[0].commit.author.email?r[0].commit.author.email:"",r[0].commit.committer&&(e.LastCommit.Committer={},e.LastCommit.Committer.Date=r[0].commit.committer.date?r[0].commit.committer.date:"",e.LastCommit.Committer.Name=r[0].commit.committer.name?r[0].commit.committer.name:"",e.LastCommit.Committer.Email=r[0].commit.committer.email?r[0].commit.committer.email:""),e.LastCommit.Message=r[0].commit.message?r[0].commit.message:"",e.LastCommit.URL=r[0].sha?o._commitURLBase+r[0].sha:null,i&&r[0].author&&r[0].author.gravatar_id?e.LastCommit.AvatarURL="https://www.gravatar.com/avatar/"+r[0].author.gravatar_id+"?d=mm":r[0].author&&r[0].author.avatar_url&&(e.LastCommit.AvatarURL=r[0].author.avatar_url)),e},function(e){return o._handleError(e)})},_refineFetchedChildren:function(r,n){var i=this,s=[],a=[];if(o>2){var u=this._getBranchName(r);n.forEach(function(e){a.push(i._injectCommitInfo(e,u)),e.Directory||e.Length||s.push(e)})}return e.all(a).then(function(){return s.length>0?i._getSHAObject(r).then(function(e){return e&&e.Sha?t("GET",i._repoURL.href+"/git/trees/"+e.Sha,{headers:this._headers,timeout:15e3}).then(function(e){var t=JSON.parse(e.response);return t&&t.tree&&s.forEach(function(e){t.tree.forEach(function(t){t.sha===e.Sha&&(e.Length=t.size)})}),n},function(e){return i._handleError(e)}):n}):n})},fetchChildren:function(e){var t=this;return e===this._repoURL.href?this._getBranches():this._getChildren(e).then(function(r){return t._refineFetchedChildren(e,r)})},loadWorkspaces:function(){return this.loadWorkspace(this._repoURL)},loadWorkspace:function(e){var t=this;return this.fetchChildren(e).then(function(r){var n={Attributes:{Archive:!1,Hidden:!1,ReadOnly:!0,SymLink:!1},Location:e,Name:null,Length:0,LocalTimeStamp:0,Directory:!0,ChildrenLocation:e,Children:r};if(e===t._repoURL.href)n.Name="repo_root";else{var o=new URL(e),i=o.pathname.substring(t.contentsPath.length+1);n.Name=decodeURIComponent(i.split("/").pop()),n.Parents=t._getParents(e)}return n},function(e){return t._handleError(e,!0)})},createProject:function(){throw"Not supported"},createFolder:function(){throw"Not supported"},createFile:function(){throw"Not supported"},deleteFile:function(){throw"Not supported"},moveFile:function(){throw"Not supported"},copyFile:function(){throw"Not supported"},read:function(e,t){if(t){var r=this,n=this._getParents(e);return null===n?{Attributes:{Archive:!1,Hidden:!1,ReadOnly:!0,SymLink:!1},Name:null===n?"":decodeURIComponent(new URL(e).pathname.substring(this._contentsPath.length+1)),Location:e,Length:0,LocalTimeStamp:0,Parents:n,Directory:!0,ChildrenLocation:e}:0===n.length?r._getSHAObject(e).then(function(e){var t=e;return t.Parents=n,e&&e.Sha&&o>0?r._injectCommitInfo(e,e.Sha,!0).then(function(){return t}):t}):this._getChildren(n[0].Location).then(function(t){var n;return t.some(function(t){return t.Location===e?(n=t,n.Parents=r._getParents(e),!0):void 0}),n?o>1?r._injectCommitInfo(n,r._getBranchName(n.Location)).then(function(){return n}):n:r._handleError({status:404,url:e})})}return this.readBlob(e).then(function(e){var t=new TextDecoder;return t.decode(e)})},write:function(){throw"Not supported"},remoteImport:function(){throw"Not supported"},remoteExport:function(){throw"Not supported"},readBlob:function(e){var n=this,o=this._refPathToQuery(e);return t("GET",o,{headers:this._headers,timeout:15e3}).then(function(e){var o=JSON.parse(e.response);return o.content&&o.size?r.decode(o.content):t("GET",o.git_url,{headers:this._headers,timeout:15e3}).then(function(e){var t=JSON.parse(e.response);return r.decode(t.content)},function(e){return n._handleError(e)})},function(t){return n._retryBlob(e,t)})},writeBlob:function(){throw"Not supported"}},n.prototype.constructor=n,n}),define("plugins/GitHubFilePlugin",["orion/plugin","orion/Deferred","plugins/filePlugin/GitHubFileImpl","orion/URL-shim"],function(e,t,r){var n={name:"GitHub File Plugin",version:"1.0",description:"GitHub File Plugin"},o=new e(n),i=new URL(window.location.href),s=new r(i.query.get("repo"),i.query.get("token")),a=s._repoURL.href;o.registerService("orion.core.file",s,{Name:"GitHub File contents",top:a,pattern:a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}),o.connect()});