!function(e,r){"function"==typeof define&&define.amd?define("orion/Deferred",r):"object"==typeof exports?module.exports=r():(e.orion=e.orion||{},e.orion.Deferred=r())}(this,function(){function e(){for(var e;e=i.shift();)e();u=!1}function r(e){i.push(e),u||(u=!0,s())}function t(e){return function(r){e(r)}}function n(e,r,n){try{var o=e(r),i=o&&("object"==typeof o||"function"==typeof o)&&o.then;if("function"==typeof i)if(o===n.promise)n.reject(new TypeError);else{var u=o.cancel;"function"==typeof u?n._parentCancel=u.bind(o):delete n._parentCancel,i.call(o,t(n.resolve),t(n.reject),t(n.progress))}else n.resolve(o)}catch(s){n.reject(s)}}function o(){function e(){for(var e;e=c.shift();){var r=e.deferred,t="fulfilled"===a?"resolve":"reject",o=e[t];"function"==typeof o?n(o,s,r):r[t](s)}}function t(t){delete f._parentCancel,a="rejected",s=t,c.length&&r(e)}function i(n){function u(e){return function(r){a&&"assumed"!==a||e(r)}}delete f._parentCancel;try{var l=n&&("object"==typeof n||"function"==typeof n)&&n.then;if("function"==typeof l)if(n===f)t(new TypeError);else{a="assumed";var h=n&&n.cancel;if("function"!=typeof h){var p=new o;n=p.promise;try{l(p.resolve,p.reject,p.progress)}catch(d){p.reject(d)}h=n.cancel,l=n.then}s=n,l.call(n,u(i),u(t)),f._parentCancel=h.bind(n)}else a="fulfilled",s=n,c.length&&r(e)}catch(m){u(t)(m)}}function u(){var e=f._parentCancel;if(e)delete f._parentCancel,e();else if(!a){var r=new Error("Cancel");r.name="Cancel",t(r)}}var s,a,c=[],f=this;this.resolve=function(e){return a||i(e),f},this.reject=function(e){return a||t(e),f},this.progress=function(e){return a||c.forEach(function(r){if(r.progress)try{r.progress(e)}catch(t){}}),f.promise},this.cancel=function(){return f._parentCancel?setTimeout(u,0):u(),f},this.then=function(t,n,i){var u=new o;return u._parentCancel=f.promise.cancel,c.push({resolve:t,reject:n,progress:i,deferred:u}),("fulfilled"===a||"rejected"===a)&&r(e),u.promise},this.promise={then:f.then,cancel:f.cancel}}var i=[],u=!1,s=function(){if("undefined"!=typeof process&&"function"==typeof process.nextTick){var r=process.nextTick;return function(){r(e)}}if("function"==typeof MutationObserver){var t=document.createElement("div"),n=new MutationObserver(e);return n.observe(t,{attributes:!0}),function(){t.setAttribute("class","_tick")}}return function(){setTimeout(e,0)}}();return o.all=function(e,r){function t(e,r){s||(u[e]=r,0===--i&&a.resolve(u))}function n(e,n){if(!s){if(r)try{return void t(e,r(n))}catch(o){n=o}a.reject(n)}}var i=e.length,u=[],s=!1,a=new o;return a.then(void 0,function(){s=!0,e.forEach(function(e){e.cancel&&e.cancel()})}),0===i?a.resolve(u):e.forEach(function(e,r){e.then(t.bind(void 0,r),n.bind(void 0,r))}),a.promise},o.when=function(e,r,t,n){var i,u;return e&&"function"==typeof e.then?i=e:(u=new o,u.resolve(e),i=u.promise),i.then(r,t,n)},o}),define("orion/xsrfUtils",[],function(){function e(){var e,r,t,o=document.cookie.split(";");for(e=0;e<o.length;e++)if(r=o[e].substr(0,o[e].indexOf("=")).trim(),t=o[e].substr(o[e].indexOf("=")+1).trim(),r==n)return t}function r(r){var t=e();t&&(r[n]=t)}function t(r){var t=e();t&&r.setRequestHeader(n,t)}var n="x-csrf-token";return{XSRF_TOKEN:n,getCSRFToken:e,setNonceHeader:r,addCSRFNonce:t}}),function(){function e(e){if("string"!=typeof e)throw new TypeError}function r(e){return e?e.split("&"):[]}function t(e){return 0===e.length?"":e.join("&")}function n(e){var r=/([^=]*)(?:=?)(.*)/.exec(e),t=r[1]?decodeURIComponent(r[1]):"",n=r[2]?decodeURIComponent(r[2]):"";return[t,n]}function o(e){var r=encodeURIComponent(e[0]);return e[1]&&(r+="="+encodeURIComponent(e[1])),r}function i(e,t){var o="",i=[],u=0;return{next:function(){if(o!==e.query&&(o=e.query,i=r(o)),u<i.length){var s=n(i[u++]);switch(t){case"keys":return s[0];case"values":return s[1];case"keys+values":return[s[0],s[1]];default:throw new TypeError}}throw C}}}function u(e){Object.defineProperty(this,"_url",{get:function(){return e._url}})}function s(e,r){if(!e.scheme&&r&&(e.scheme=r.scheme,!e.host&&r.host&&(e.userinfo=r.userinfo,e.host=r.host,e.port=r.port,e.pathRelative=!0)),e.pathRelative)if(e.path){if("/"!==e.path[0]){var t=/^(.*\/)[^\/]*$/.exec(r.path)[1]||"/";e.path=t+e.path}}else e.path=r.path}function a(e){return e.toLowerCase()}function c(e){return e?/[1-9]\d*$/.exec(e)[0]:""}function f(e){var r=[];return e.split("/").forEach(function(e){".."===e?r.pop():"."!==e&&r.push(e)}),r.join("/")}function l(e){e.scheme&&(e.scheme=a(e.scheme)),e.port&&(e.port=c(e.port)),e.host&&e.path&&(e.path=f(e.path))}function h(e){return e.replace(/\s/g,function(e){return"%"+e.charCodeAt(0).toString(16)})}function p(e,r){if("string"!=typeof e)throw new TypeError;e=h(e);var t=g.exec(e);if(!t)return null;var n={};if(n.scheme=t[1]||"",n.scheme&&!b.test(n.scheme))return null;var o=t[2];if(o){var i=_.exec(o);if(n.userinfo=i[1],n.host=i[2],n.port=i[3],n.port&&!j.test(n.port))return null}return n.path=t[3],n.query=t[4],n.fragment=t[5],s(n,r),l(n),n}function d(e){var r=e.scheme?e.scheme+":":"";return e.host&&(r+="//",e.userinfo&&(r+=e.userinfo+"@"),r+=e.host,e.port&&(r+=":"+e.port)),r+=e.path,e.query&&(r+="?"+e.query),e.fragment&&(r+="#"+e.fragment),r}function m(e,r){var t;if(r){if(r=r.href||r,t=p(r),!t||!t.scheme)throw new SyntaxError;Object.defineProperty(this,"_baseURL",{value:t})}var n=p(e,t);if(!n)throw new SyntaxError;Object.defineProperty(this,"_input",{value:e,writable:!0}),Object.defineProperty(this,"_url",{value:n,writable:!0});var o=new u(this);Object.defineProperty(this,"query",{get:function(){return this._url?o:null},enumerable:!0})}try{var v;if("function"==typeof window.URL&&0!==window.URL.length&&"http:"===(v=new window.URL("http://www.w3.org?q")).protocol&&v.query)return}catch(y){}var g=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/,_=/^(?:(.*)@)?(\[[^\]]*\]|[^:]*)(?::(.*))?$/,w=/^\S*$/,b=/^([a-zA-Z](?:[a-zA-Z0-9+-.])*)$/,j=/^\d*$/,x=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)$/,O=/^(\[[^\]\/?#\s]*\]|[^:\/?#\s]*)(?::(\d*))?$/,E=/^([^?#\s]*)$/,R=/^([^\s]*)$/,q=w,S=/([^:]*):?(.*)/,C="undefined"!=typeof StopIteration?StopIteration:new Error("Stop Iteration"),T={"ftp:":"21","gopher:":"70","http:":"80","https:":"443","ws:":"80","wss:":"443"};Object.defineProperties(u.prototype,{get:{value:function(t){e(t);var o,i=r(this._url.query);return i.some(function(e){var r=n(e);return r[0]===t?(o=r[1],!0):void 0}),o},enumerable:!0},set:{value:function(i,u){e(i),e(u);var s=r(this._url.query),a=s.some(function(e,r){var t=n(e);return t[0]===i?(t[1]=u,s[r]=o(t),!0):void 0});a||s.push(o([i,u])),this._url.query=t(s)},enumerable:!0},has:{value:function(t){e(t);var o=r(this._url.query);return o.some(function(e){var r=n(e);return r[0]===t?!0:void 0})},enumerable:!0},"delete":{value:function(o){e(o);var i=r(this._url.query),u=i.filter(function(e){var r=n(e);return r[0]!==o});return u.length!==i.length?(this._url.query=t(u),!0):!1},enumerable:!0},clear:{value:function(){this._url.query=""},enumerable:!0},forEach:{value:function(e,r){if("function"!=typeof e)throw new TypeError;var t=i(this._url,"keys+values");try{for(;;){var n=t.next();e.call(r,n[1],n[0],this)}}catch(o){if(o!==C)throw o}},enumerable:!0},keys:{value:function(){return i(this._url,"keys")},enumerable:!0},values:{value:function(){return i(this._url,"values")},enumerable:!0},items:{value:function(){return i(this._url,"keys+values")}},size:{get:function(){return r(this._url.query).length},enumerable:!0},getAll:{value:function(t){e(t);var o=[],i=r(this._url.query);return i.forEach(function(e){var r=n(e);r[0]===t&&o.push(r[1])}),o},enumerable:!0},append:{value:function(n,i){e(n),e(i);var u=r(this._url.query);u.push(o([n,i])),this._url.query=t(u)},enumerable:!0}}),Object.defineProperties(m.prototype,{href:{get:function(){return this._url?d(this._url):this._input},set:function(r){e(r),this._input=r,this._url=p(this._input,this._baseURL)},enumerable:!0},origin:{get:function(){return this._url&&this._url.host?this.protocol+"//"+this.host:""},enumerable:!0},protocol:{get:function(){return this._url?this._url.scheme+":":":"},set:function(r){if(e(r),this._url){var t=":"===r.slice(-1)?r.substring(0,r.length-1):r;(""===t||b.test(t))&&(this._url.scheme=a(t))}},enumerable:!0},_userinfo:{get:function(){return this._url?this._url.userinfo:""},set:function(r){e(r),this._url&&(this._url.userinfo=r)}},username:{get:function(){if(!this._url)return"";var e=S.exec(this._userinfo),r=decodeURIComponent(e[1]||"");return r},set:function(r){if(e(r),this._url){var t=S.exec(this._userinfo),n=[encodeURIComponent(r||"")];t[2]&&n.push(t[2]),this._userinfo=n.join(":")}},enumerable:!0},password:{get:function(){if(!this._url)return"";var e=S.exec(this._userinfo),r=decodeURIComponent(e[2]||"");return r},set:function(r){if(e(r),this._url){var t=S.exec(this._userinfo),n=[t[1]||""];r&&n.push(encodeURIComponent(r)),this._userinfo=n.join(":")}},enumerable:!0},host:{get:function(){var e="";return this._url&&this._url.host&&(e+=this._url.host,this._url.port&&(e+=":"+this._url.port)),e},set:function(r){if(e(r),this._url){var t=O.exec(r);t&&(this._url.host=t[1],this._url.port=c(t[2]))}},enumerable:!0},hostname:{get:function(){return this._url?this._url.host:""},set:function(r){if(e(r),this._url){var t=x.exec(r);t&&(this._url.host=r)}},enumerable:!0},port:{get:function(){var e=this._url?this._url.port||"":"";return e&&e===T[this.protocol]&&(e=""),e},set:function(r){if(e(r),this._url){var t=j.exec(r);t&&(this._url.port=c(r))}},enumerable:!0},pathname:{get:function(){return this._url?this._url.path:""},set:function(r){if(e(r),this._url){var t=E.exec(r);t&&(this._url.host&&r&&"/"!==r[0]&&(r="/"+r),this._url.path=r?f(r):"")}},enumerable:!0},search:{get:function(){return this._url&&this._url.query?"?"+this._url.query:""},set:function(r){if(e(r),this._url){r&&"?"===r[0]&&(r=r.substring(1));var t=R.exec(r);t&&(this._url.query=r)}},enumerable:!0},hash:{get:function(){return this._url&&this._url.fragment?"#"+this._url.fragment:""},set:function(r){if(e(r),this._url){r&&"#"===r[0]&&(r=r.substring(1));var t=q.exec(r);t&&(this._url.fragment=r)}},enumerable:!0}});var U=window.URL||window.webkitURL;U&&U.createObjectURL&&(Object.defineProperty(m,"createObjectURL",{value:U.createObjectURL.bind(U),enumerable:!1}),Object.defineProperty(m,"revokeObjectURL",{value:U.revokeObjectURL.bind(U),enumerable:!1})),window.URL=m}(),define("orion/URL-shim",function(){}),define("orion/xhr",["orion/Deferred","orion/xsrfUtils","orion/URL-shim"],function(e,r){function t(e,r,t,n){var o,i="undefined"!=typeof t.response?t.response:t.responseText,u="string"==typeof i?i:null;try{o=t.status}catch(s){o=0}var a={args:r,response:i,responseText:u,status:o,url:e,xhr:t};return"undefined"!=typeof n&&(a.error=n),a}function n(e){return new URL(location.href).origin===new URL(e,location.href).origin}function o(o,i,u){u=u||{};var s=arguments.length>3&&arguments[3]?arguments[3]:new XMLHttpRequest,a=new e,c=u.headers||{};n(i)&&r.setNonceHeader(c);var f,l=u.log||!1;"undefined"==typeof c["X-Requested-With"]&&(c["X-Requested-With"]="XMLHttpRequest"),"undefined"==typeof u.data||"POST"!==o&&"PUT"!==o||(f=u.data);var h=!1,p=!1;a.promise.then(void 0,function(e){h=!0,!p&&e instanceof Error&&"Cancel"===e.name&&s.abort()}),s.onabort=function(){if(p=!0,!h){var e=new Error("Cancel");e.name="Cancel",a.reject(e)}},s.onload=function(){var e=t(i,u,s);200<=s.status&&s.status<400?a.resolve(e):(a.reject(e),l&&"undefined"!=typeof console&&console.log(new Error(s.statusText)))},s.onerror=function(){var e=t(i,u,s);a.reject(e),l&&"undefined"!=typeof console&&console.log(new Error(s.statusText))},s.onprogress=function(e){e.xhr=s,a.progress(e)};try{if(s.open(o,i,!0),"string"==typeof u.responseType&&(s.responseType=u.responseType),"number"==typeof u.timeout)if("number"==typeof s.timeout)s.timeout=u.timeout,s.addEventListener("timeout",function(){a.reject(t(i,u,s,"Timeout exceeded"))});else{var d=setTimeout(function(){a.reject(t(i,u,s,"Timeout exceeded"))},u.timeout);a.promise.then(clearTimeout.bind(null,d),clearTimeout.bind(null,d))}Object.keys(c).forEach(function(e){s.setRequestHeader(e,c[e])}),s.send(f||null)}catch(m){a.reject(t(i,u,s,m))}return a.promise}return o}),function(e,r){"function"==typeof define&&define.amd?define("orion/plugin",["orion/Deferred"],r):"object"==typeof exports?module.exports=r(require("orion/Deferred")):(e.orion=e.orion||{},e.orion.PluginProvider=r(e.orion.Deferred))}(this,function(e){function r(e,r){this.__objectId=e,this.__methods=r}function t(t){function n(e){w&&("undefined"==typeof ArrayBuffer&&(e=JSON.stringify(e)),w===self?w.postMessage(e):w.postMessage(e,"*"))}function o(){var e=[];return Object.keys(_).forEach(function(r){var t=_[r];e.push({serviceId:r,names:t.names,methods:t.methods,properties:t.properties})}),{headers:l||{},services:e}}function i(e,r){if(r&&r instanceof XMLHttpRequest){var t,n;try{t=r.status,n=r.statusText}catch(o){t=0,n=""}return{status:t||0,statusText:n}}return r}function u(e){var r=e?JSON.parse(JSON.stringify(e,i)):e;return e instanceof Error&&(r.__isError=!0,r.message=r.message||e.message,r.name=r.name||e.name),r}function s(t){if(!w)return(new e).reject(new Error("plugin not connected"));t.id=String(p++);var n=new e;y[t.id]=n,n.then(null,function(e){h&&e instanceof Error&&"Cancel"===e.name&&b({requestId:t.id,method:"cancel",params:e.message?[e.message]:[]})});var o=Object.prototype.toString;return t.params.forEach(function(e,i){if("[object Object]"===o.call(e)&&!(e instanceof r)){var u,s;for(u in e)"[object Function]"===o.call(e[u])&&(s=s||[],s.push(u));if(s){var a=d++;g[a]=e;var c=function(){delete g[a]};n.then(c,c),t.params[i]=new r(a,s)}}}),b(t),n.promise}function a(e,r){e||0===e?b({id:e,result:null,error:r}):console.log(r)}function c(e,r,t,n){n.forEach(function(e,r){if(e&&"undefined"!=typeof e.__objectId){var t={};e.__methods.forEach(function(r){t[r]=function(){return s({objectId:e.__objectId,method:r,params:Array.prototype.slice.call(arguments)})}}),n[r]=t}});var o="undefined"==typeof e?null:{id:e,result:null,error:null};try{var i=t.apply(r,n);if(!o)return;i&&"function"==typeof i.then?(v[e]=i,i.then(function(r){delete v[e],o.result=r,b(o)},function(r){v[e]&&(delete v[e],o.error=u(r),b(o))},function(){b({responseId:e,method:"progress",params:Array.prototype.slice.call(arguments)})})):(o.result=i,b(o))}catch(a){o&&(o.error=u(a),b(o))}}function f(e){if(e.source===w||"undefined"==typeof window){var r="string"!=typeof e.data?e.data:JSON.parse(e.data);try{if(r.method){var t=r.method,n=r.params||[];if("serviceId"in r){var o=_[r.serviceId];o||a(r.id,"service not found"),o=o.implementation,t in o?c(r.id,o,o[t],n):a(r.id,"method not found")}else if("objectId"in r){var i=g[r.objectId];i||a(r.id,"object not found"),!t in i?c(r.id,i,i[t],n):a(r.id,"method not found")}else if("requestId"in r){var u=v[r.requestId];u&&"cancel"===t&&u.cancel&&u.cancel.apply(u,n)}else{if(!("responseId"in r))throw new Error("Bad method: "+r.method);var s=y[r.responseId];s&&"progress"===t&&s.progress&&s.progress.apply(s,n)}}else{var f=y[String(r.id)];delete y[String(r.id)],r.error?f.reject(r.error):f.resolve(r.result)}}catch(l){console.log("Plugin._messageHandler "+l)}}}var l=t,h=!1,p=0,d=0,m=0,v={},y={},g={},_={},w=null;"undefined"==typeof window?w=self:window!==window.parent?w=window.parent:null!==window.opener&&(w=window.opener);var b=n;n({method:"loading"}),this.updateHeaders=function(e){if(h)throw new Error("Cannot update headers. Plugin Provider is connected");l=e},this.registerService=function(e,r,t){if(h)throw new Error("Cannot register service. Plugin Provider is connected");"string"==typeof e?e=[e]:Array.isArray(e)||(e=[]);var n=null,o=[];for(n in r)"function"==typeof r[n]&&o.push(n);_[m++]={names:e,methods:o,implementation:r,properties:t||{},listeners:{}}},this.registerServiceProvider=this.registerService,this.connect=function(e,r){if(h)return void(e&&e());if(!w)return void(r&&r("No valid plugin target"));addEventListener("message",f,!1);var t={method:"plugin",params:[o()]};n(t),h=!0,e&&e()},this.disconnect=function(){h&&(removeEventListener("message",f),w=null,h=!1)}}return t}),define("plugins/npmPlugin",["orion/xhr","orion/plugin"],function(e,r){var t={name:"Orion NPM",version:"1.0",description:"Orion NPM"},n=new r(t);n.registerServiceProvider("orion.shell.command",null,{name:"npm",description:"Commands for interacting with node npm"});var o={callback:function(r,t){r.cwd=t.cwd,r.type="shrinkwrap";var n=e("POST","/npm",{headers:{"Orion-Version":"1"},data:JSON.stringify(r),timeout:3e5}).then(function(e){if(e.response){var r=JSON.parse(e.response);return r.cmdOutput}return""},function(e){return e.error});return n}};n.registerServiceProvider("orion.shell.command",o,{name:"npm shrinkwrap",description:"npm shrinkwrap",parameters:null});var i={callback:function(r,t){r.cwd=t.cwd,r.type="install";var n=e("POST","/npm",{headers:{"Orion-Version":"1"},data:JSON.stringify(r),timeout:3e5}).then(function(e){if(e.response){var r=JSON.parse(e.response);return r.cmdOutput}return""},function(e){return e.error});return n}};n.registerServiceProvider("orion.shell.command",i,{name:"npm install",description:"npm install",parameters:[{name:"package",type:"string",description:"package to install",defaultValue:null}]}),n.connect()});